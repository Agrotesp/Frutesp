<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FRUTESP ‚Äì Gest√£o Operacional</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --g900:#040F09;--g800:#071A10;--g750:#0B2B1A;--g700:#0B3D2E;
  --g600:#0F4F3A;--g500:#145C43;--g400:#1A7055;--g300:#1F7A5C;
  --g200:#2BA87B;--g150:#4DC99A;--g100:#A8E8CC;--g050:#E4F5EE;
  --surface-card:rgba(15,79,58,0.5);--surface-card2:rgba(20,92,67,0.4);
  --surface-input:rgba(7,26,16,0.8);
  --text-1:#E8F5EE;--text-2:#9FCFB5;--text-3:#5A9478;
  --border:rgba(255,255,255,0.08);--border-md:rgba(255,255,255,0.14);
  --border-hi:rgba(43,168,123,0.4);
  --red:#F06060;--red-bg:rgba(240,96,96,0.15);
  --orange:#F0A060;--or-bg:rgba(240,160,96,0.15);
  --yellow:#E0C060;--yl-bg:rgba(224,192,96,0.15);
  --blue:#60A8F0;--bl-bg:rgba(96,168,240,0.15);
  --radius:14px;--radius-sm:9px;
  --shadow:0 4px 20px rgba(0,0,0,0.4);--shadow-lg:0 12px 40px rgba(0,0,0,0.55);
  --glow:0 0 24px rgba(43,168,123,0.25);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'DM Sans',sans-serif;background:var(--g800);color:var(--text-1);min-height:100vh;font-size:15px;-webkit-font-smoothing:antialiased;}
h1,h2,h3,h4{font-family:'Syne',sans-serif;}
::-webkit-scrollbar{width:4px;height:4px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:var(--g400);border-radius:4px;}

.screen{display:none;min-height:100vh;}
.screen.active{display:flex;flex-direction:column;}

/* ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ */
#screen-auth{background:var(--g900);align-items:center;justify-content:center;padding:24px;position:relative;overflow:hidden;}
#screen-auth::before{content:'';position:absolute;top:-160px;right:-160px;width:420px;height:420px;background:radial-gradient(circle,var(--g400) 0%,transparent 65%);opacity:.25;pointer-events:none;}
#screen-auth::after{content:'';position:absolute;bottom:-100px;left:-100px;width:300px;height:300px;background:radial-gradient(circle,var(--g300) 0%,transparent 65%);opacity:.2;pointer-events:none;}
.auth-card{background:linear-gradient(160deg,var(--g750) 0%,var(--g700) 100%);border:1px solid var(--border-md);border-radius:24px;padding:40px 32px;width:100%;max-width:420px;box-shadow:var(--shadow-lg);position:relative;z-index:1;}
.auth-logo{text-align:center;margin-bottom:32px;}
.logo-mark{width:70px;height:70px;background:linear-gradient(135deg,var(--g400),var(--g200));border-radius:20px;display:inline-flex;align-items:center;justify-content:center;font-size:34px;margin-bottom:14px;box-shadow:var(--glow);}
.auth-logo h1{font-size:26px;color:var(--text-1);letter-spacing:-.5px;}
.auth-logo h1 span{color:var(--g150);}
.auth-logo p{color:var(--text-3);font-size:13px;margin-top:5px;}
.auth-tabs{display:flex;gap:4px;background:var(--g800);border-radius:10px;padding:4px;margin-bottom:28px;}
.auth-tab{flex:1;padding:9px;border-radius:7px;text-align:center;font-size:13px;font-weight:600;cursor:pointer;border:none;background:transparent;color:var(--text-3);font-family:'DM Sans',sans-serif;transition:all .2s;}
.auth-tab.active{background:var(--g500);color:var(--text-1);}

/* ‚îÄ‚îÄ FORMS ‚îÄ‚îÄ */
.form-group{margin-bottom:16px;}
.form-group label{display:block;font-size:11px;font-weight:600;color:var(--text-3);margin-bottom:7px;text-transform:uppercase;letter-spacing:.6px;}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:12px 14px;background:var(--surface-input);border:1.5px solid var(--border-md);border-radius:var(--radius-sm);color:var(--text-1);font-family:'DM Sans',sans-serif;font-size:15px;outline:none;transition:border-color .2s,background .2s;}
.form-group input::placeholder{color:var(--text-3);}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:var(--g200);background:rgba(7,26,16,.95);}
.form-group select option{background:var(--g700);color:var(--text-1);}
.form-group textarea{resize:vertical;min-height:80px;line-height:1.5;}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:13px 20px;border-radius:var(--radius-sm);font-family:'DM Sans',sans-serif;font-size:15px;font-weight:600;cursor:pointer;border:none;transition:all .18s;text-decoration:none;white-space:nowrap;}
.btn-primary{background:linear-gradient(135deg,var(--g300),var(--g200));color:var(--g900);width:100%;box-shadow:0 4px 16px rgba(43,168,123,.35);}
.btn-primary:hover{box-shadow:0 6px 22px rgba(43,168,123,.5);transform:translateY(-1px);}
.btn-secondary{background:var(--surface-card);color:var(--text-2);border:1px solid var(--border-md);}
.btn-secondary:hover{background:var(--g500);color:var(--text-1);}
.btn-danger{background:var(--red-bg);color:var(--red);border:1px solid rgba(240,96,96,.25);}
.btn-sm{padding:7px 12px;font-size:13px;}
.btn-icon{padding:9px;border-radius:var(--radius-sm);background:var(--surface-card);color:var(--text-2);cursor:pointer;border:1px solid var(--border);font-size:18px;display:inline-flex;align-items:center;justify-content:center;transition:all .2s;}
.btn-icon:hover{background:var(--g400);color:var(--text-1);}

.error-msg{background:var(--red-bg);color:var(--red);border:1px solid rgba(240,96,96,.3);padding:10px 14px;border-radius:var(--radius-sm);font-size:13px;margin-bottom:16px;display:none;}
.success-msg{background:rgba(43,168,123,.15);color:var(--g150);border:1px solid rgba(43,168,123,.3);padding:10px 14px;border-radius:var(--radius-sm);font-size:13px;margin-bottom:16px;display:none;}

/* ‚îÄ‚îÄ APP ‚îÄ‚îÄ */
.topbar{background:var(--g900);border-bottom:1px solid var(--border-md);padding:0 16px;height:56px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:100;}
.topbar-logo{font-family:'Syne',sans-serif;font-size:17px;font-weight:800;letter-spacing:-.3px;flex:1;color:var(--text-1);}
.topbar-logo span{color:var(--g150);}
.topbar-badge{font-size:11px;background:var(--surface-card);color:var(--text-3);padding:3px 10px;border-radius:10px;border:1px solid var(--border);}
.topbar-avatar{width:34px;height:34px;background:linear-gradient(135deg,var(--g400),var(--g200));border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:var(--g900);cursor:pointer;box-shadow:var(--glow);}
.main-content{flex:1;overflow-y:auto;padding-bottom:80px;}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--g900);border-top:1px solid var(--border-md);display:flex;z-index:100;}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:8px 2px 10px;gap:3px;cursor:pointer;border:none;background:transparent;color:var(--text-3);font-family:'DM Sans',sans-serif;font-size:10px;font-weight:500;transition:color .2s;position:relative;}
.nav-item .nav-icon{font-size:19px;transition:transform .2s;}
.nav-item.active{color:var(--g150);}
.nav-item.active .nav-icon{transform:scale(1.1);}
.nav-badge{position:absolute;top:5px;right:calc(50% - 19px);background:var(--red);color:white;font-size:9px;font-weight:700;min-width:15px;height:15px;border-radius:8px;display:flex;align-items:center;justify-content:center;padding:0 3px;}

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.page{display:none;padding:16px;}
.page.active{display:block;}
.page-header{display:flex;align-items:center;gap:12px;margin-bottom:20px;}
.page-header h2{font-size:20px;color:var(--text-1);flex:1;}
.section-label{font-size:10px;font-weight:700;letter-spacing:1.2px;text-transform:uppercase;color:var(--text-3);margin-bottom:12px;padding-left:2px;}

/* ‚îÄ‚îÄ STATS ‚îÄ‚îÄ */
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px;}
.stat-card{background:linear-gradient(160deg,var(--surface-card),var(--surface-card2));border:1px solid var(--border);border-radius:var(--radius);padding:16px;position:relative;overflow:hidden;}
.stat-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;border-radius:var(--radius) var(--radius) 0 0;}
.stat-card.green::before{background:linear-gradient(90deg,var(--g300),var(--g150));}
.stat-card.red::before{background:linear-gradient(90deg,var(--red),#ff9090);}
.stat-card.orange::before{background:linear-gradient(90deg,var(--orange),#ffd090);}
.stat-card.blue::before{background:linear-gradient(90deg,var(--blue),#90d0ff);}
.stat-value{font-family:'Syne',sans-serif;font-size:30px;font-weight:800;line-height:1;color:var(--text-1);}
.stat-card.red .stat-value{color:var(--red);}
.stat-card.orange .stat-value{color:var(--orange);}
.stat-card.blue .stat-value{color:var(--blue);}
.stat-icon{font-size:20px;margin-bottom:8px;display:block;}
.stat-label{font-size:11px;color:var(--text-3);margin-top:5px;font-weight:500;}

.chart-card{background:linear-gradient(160deg,var(--surface-card),var(--surface-card2));border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px;}
.chart-card h4{font-size:13px;color:var(--text-2);margin-bottom:16px;font-weight:600;}
.bar-chart{display:flex;flex-direction:column;gap:11px;}
.bar-row{display:flex;align-items:center;gap:10px;}
.bar-label{font-size:12px;color:var(--text-3);width:90px;flex-shrink:0;}
.bar-track{flex:1;height:8px;background:var(--g800);border-radius:4px;overflow:hidden;}
.bar-fill{height:100%;border-radius:4px;transition:width .8s ease;}
.bar-val{font-size:12px;font-weight:600;color:var(--text-2);width:24px;text-align:right;}

/* ‚îÄ‚îÄ TICKETS ‚îÄ‚îÄ */
.ticket-filters{display:flex;gap:8px;overflow-x:auto;padding-bottom:4px;margin-bottom:14px;scrollbar-width:none;}
.ticket-filters::-webkit-scrollbar{display:none;}
.filter-chip{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;cursor:pointer;border:1px solid var(--border-md);background:var(--surface-card);color:var(--text-3);white-space:nowrap;transition:all .2s;}
.filter-chip.active{background:var(--g300);border-color:var(--g300);color:var(--g900);}
.ticket-list{display:flex;flex-direction:column;gap:10px;}
.ticket-card{background:linear-gradient(160deg,var(--surface-card),var(--surface-card2));border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;cursor:pointer;transition:all .2s;border-left:3px solid var(--g300);}
.ticket-card:hover{border-color:var(--border-hi);box-shadow:var(--shadow);}
.ticket-card:active{transform:scale(.99);}
.ticket-card.priority-critica{border-left-color:var(--red);}
.ticket-card.priority-alta{border-left-color:var(--orange);}
.ticket-card.priority-media{border-left-color:var(--yellow);}
.ticket-card.priority-baixa{border-left-color:var(--blue);}
.ticket-card.sla-vencido{background:linear-gradient(160deg,rgba(240,96,96,.08),var(--surface-card2));}
.ticket-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:6px;}
.ticket-proto{font-size:11px;color:var(--text-3);font-weight:600;font-family:'Syne',sans-serif;}
.ticket-title{font-size:15px;font-weight:600;color:var(--text-1);margin-bottom:8px;line-height:1.3;}
.ticket-meta{display:flex;flex-wrap:wrap;gap:6px;align-items:center;}
.ticket-sla-bar{margin-top:10px;height:3px;background:var(--g800);border-radius:2px;overflow:hidden;}
.ticket-sla-fill{height:100%;border-radius:2px;transition:width .5s;}

/* ‚îÄ‚îÄ BADGES ‚îÄ‚îÄ */
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 9px;border-radius:20px;font-size:11px;font-weight:600;}
.badge-status-OPEN{background:var(--bl-bg);color:var(--blue);border:1px solid rgba(96,168,240,.2);}
.badge-status-IN_PROGRESS{background:var(--or-bg);color:var(--orange);border:1px solid rgba(240,160,96,.2);}
.badge-status-WAITING{background:var(--yl-bg);color:var(--yellow);border:1px solid rgba(224,192,96,.2);}
.badge-status-DONE{background:rgba(43,168,123,.15);color:var(--g150);border:1px solid rgba(43,168,123,.2);}
.badge-status-CANCELED{background:rgba(255,255,255,.05);color:var(--text-3);border:1px solid var(--border);}
.badge-priority-critica{background:var(--red-bg);color:var(--red);}
.badge-priority-alta{background:var(--or-bg);color:var(--orange);}
.badge-priority-media{background:var(--yl-bg);color:var(--yellow);}
.badge-priority-baixa{background:var(--bl-bg);color:var(--blue);}
.badge-sla{background:var(--red-bg);color:var(--red);}
.badge-setor{background:rgba(43,168,123,.12);color:var(--g150);border:1px solid rgba(43,168,123,.15);}
.badge-drone{background:var(--bl-bg);color:var(--blue);border:1px solid rgba(96,168,240,.2);}

/* ‚îÄ‚îÄ DETAIL ‚îÄ‚îÄ */
#ticket-detail-overlay{position:fixed;inset:0;background:var(--g800);z-index:250;overflow-y:auto;flex-direction:column;}
.detail-header{background:var(--g900);border-bottom:1px solid var(--border-md);padding:14px 16px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:10;}
.detail-header h3{flex:1;font-size:15px;color:var(--text-1);}
.detail-body{padding:16px;padding-bottom:100px;}
.detail-section{background:linear-gradient(160deg,var(--surface-card),var(--surface-card2));border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px;}
.detail-section h4{font-size:11px;font-weight:700;color:var(--text-3);margin-bottom:14px;text-transform:uppercase;letter-spacing:.8px;}
.detail-row{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid var(--border);}
.detail-row:last-child{border-bottom:none;padding-bottom:0;}
.dr-label{font-size:13px;color:var(--text-3);}
.dr-value{font-size:14px;font-weight:600;color:var(--text-1);text-align:right;max-width:55%;}
.action-bar{position:fixed;bottom:0;left:0;right:0;background:var(--g900);border-top:1px solid var(--border-md);padding:12px 16px;display:flex;gap:10px;z-index:200;}
.action-bar .btn{flex:1;}

/* ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ */
.chat-messages{overflow-y:auto;padding:12px;display:flex;flex-direction:column;gap:10px;min-height:120px;}
.chat-msg{max-width:82%;}
.chat-msg.mine{align-self:flex-end;}
.chat-msg.other{align-self:flex-start;}
.chat-bubble{padding:10px 14px;border-radius:14px;font-size:14px;line-height:1.5;}
.chat-msg.mine .chat-bubble{background:linear-gradient(135deg,var(--g400),var(--g300));color:var(--g900);border-bottom-right-radius:4px;}
.chat-msg.other .chat-bubble{background:var(--surface-card);color:var(--text-1);border:1px solid var(--border-md);border-bottom-left-radius:4px;}
.chat-meta{font-size:10px;color:var(--text-3);margin-top:4px;padding:0 4px;}
.chat-msg.mine .chat-meta{text-align:right;}
.chat-input-area{display:flex;gap:8px;align-items:flex-end;padding:12px;background:var(--g900);border-top:1px solid var(--border);}
.chat-input-area textarea{flex:1;padding:10px 14px;background:var(--surface-input);border:1.5px solid var(--border-md);border-radius:20px;color:var(--text-1);font-family:'DM Sans',sans-serif;font-size:14px;resize:none;max-height:100px;outline:none;}
.chat-input-area textarea::placeholder{color:var(--text-3);}
.chat-input-area textarea:focus{border-color:var(--g200);}
.chat-send-btn{width:42px;height:42px;flex-shrink:0;background:linear-gradient(135deg,var(--g300),var(--g200));color:var(--g900);border:none;border-radius:50%;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
.sector-tabs{display:flex;overflow-x:auto;gap:8px;padding-bottom:4px;margin-bottom:14px;scrollbar-width:none;}
.sector-tabs::-webkit-scrollbar{display:none;}
.sector-tab{padding:7px 14px;border-radius:20px;font-size:12px;font-weight:600;cursor:pointer;border:1px solid var(--border-md);background:var(--surface-card);color:var(--text-3);white-space:nowrap;transition:all .2s;}
.sector-tab.active{background:var(--g300);border-color:var(--g300);color:var(--g900);}

/* ‚îÄ‚îÄ EQUIP ‚îÄ‚îÄ */
.equip-card{background:linear-gradient(160deg,var(--surface-card),var(--surface-card2));border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-bottom:10px;display:flex;align-items:center;gap:14px;cursor:pointer;transition:all .2s;}
.equip-card:hover{border-color:var(--border-hi);}
.equip-icon{width:46px;height:46px;background:var(--g600);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;border:1px solid var(--border);}
.equip-info{flex:1;}
.equip-name{font-weight:600;font-size:15px;color:var(--text-1);}
.equip-sub{font-size:12px;color:var(--text-3);margin-top:2px;}
.equip-status{font-size:11px;font-weight:700;padding:3px 10px;border-radius:10px;}
.equip-status.ativo{background:rgba(43,168,123,.15);color:var(--g150);}
.equip-status.manutencao{background:var(--or-bg);color:var(--orange);}
.equip-status.inativo{background:rgba(255,255,255,.05);color:var(--text-3);}

/* ‚îÄ‚îÄ DRONE ‚îÄ‚îÄ */
.drone-header-card{background:linear-gradient(135deg,var(--g600),var(--g400));border-radius:var(--radius);padding:20px;margin-bottom:16px;border:1px solid var(--border-hi);display:flex;align-items:center;gap:16px;}
.drone-icon-big{font-size:42px;}
.drone-header-text h3{font-size:18px;color:var(--text-1);}
.drone-header-text p{font-size:13px;color:var(--text-2);margin-top:4px;}
.drone-status-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px;}
.drone-stat{background:var(--surface-card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px;}
.drone-stat .ds-val{font-family:'Syne',sans-serif;font-size:22px;font-weight:800;color:var(--text-1);}
.drone-stat .ds-lbl{font-size:11px;color:var(--text-3);margin-top:3px;}
.drone-card{background:linear-gradient(160deg,var(--surface-card),var(--surface-card2));border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;cursor:pointer;transition:all .2s;margin-bottom:10px;}
.drone-card:hover{border-color:var(--border-hi);}
.drone-card-top{display:flex;align-items:center;gap:12px;margin-bottom:10px;}
.drone-avatar{width:40px;height:40px;background:var(--g500);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;border:1px solid var(--border);}
.drone-card-name{font-weight:600;font-size:15px;color:var(--text-1);}
.drone-card-code{font-size:12px;color:var(--text-3);}
.drone-card-meta{display:flex;flex-wrap:wrap;gap:6px;}
.drone-card-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-top:12px;background:var(--g800);border-radius:var(--radius-sm);padding:12px;}
.dcs-item{text-align:center;}
.dcs-val{font-size:15px;font-weight:700;color:var(--text-1);}
.dcs-lbl{font-size:10px;color:var(--text-3);margin-top:2px;}
.mission-card{background:var(--surface-card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:12px 14px;margin-bottom:8px;transition:all .2s;}
.mission-card:hover{border-color:var(--border-hi);}
.mission-title{font-weight:600;font-size:14px;color:var(--text-1);margin-bottom:6px;}
.mission-meta{display:flex;flex-wrap:wrap;gap:6px;font-size:12px;color:var(--text-3);}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:300;align-items:flex-end;}
.modal-overlay.active{display:flex;}
.modal-sheet{background:var(--g700);border:1px solid var(--border-md);border-radius:20px 20px 0 0;padding:20px 20px 40px;width:100%;max-height:92vh;overflow-y:auto;animation:slideUp .3s ease;}
@keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal-handle{width:40px;height:4px;background:var(--border-md);border-radius:2px;margin:0 auto 20px;}
.modal-title{font-family:'Syne',sans-serif;font-size:18px;color:var(--text-1);margin-bottom:20px;}
.modal-footer{display:flex;gap:10px;margin-top:8px;}
.modal-footer .btn{flex:1;}

/* ‚îÄ‚îÄ FAB ‚îÄ‚îÄ */
.fab{position:fixed;bottom:76px;right:16px;width:52px;height:52px;background:linear-gradient(135deg,var(--g300),var(--g200));color:var(--g900);border:none;border-radius:50%;font-size:26px;cursor:pointer;box-shadow:0 4px 20px rgba(43,168,123,.45);display:flex;align-items:center;justify-content:center;z-index:99;transition:all .2s;font-weight:700;}
.fab:hover{transform:scale(1.08);}
.fab:active{transform:scale(.97);}

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast{position:fixed;bottom:86px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--g500);color:var(--text-1);border:1px solid var(--border-md);padding:12px 20px;border-radius:10px;font-size:14px;font-weight:500;z-index:999;opacity:0;transition:all .3s;white-space:nowrap;box-shadow:var(--shadow);}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

/* ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ */
.profile-banner{background:linear-gradient(135deg,var(--g600),var(--g400));border-radius:var(--radius);padding:24px 20px;margin-bottom:16px;border:1px solid var(--border-hi);display:flex;align-items:center;gap:16px;}
.profile-avatar-lg{width:60px;height:60px;background:linear-gradient(135deg,var(--g200),var(--g150));border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:22px;font-weight:700;color:var(--g900);}
.profile-name{font-size:18px;font-weight:700;color:var(--text-1);}
.profile-role{font-size:13px;color:var(--text-2);margin-top:2px;}
.profile-setor{font-size:11px;background:rgba(255,255,255,.12);color:var(--text-2);padding:3px 10px;border-radius:10px;display:inline-block;margin-top:6px;}
.menu-item{display:flex;align-items:center;gap:14px;background:var(--surface-card);border:1px solid var(--border);border-radius:var(--radius-sm);padding:14px 16px;margin-bottom:8px;cursor:pointer;transition:all .2s;width:100%;text-align:left;font-family:'DM Sans',sans-serif;}
.menu-item:hover{background:var(--g500);border-color:var(--border-md);}
.mi-icon{font-size:20px;}.mi-label{flex:1;font-size:15px;font-weight:500;color:var(--text-1);}.mi-arrow{color:var(--text-3);font-size:18px;}

/* ‚îÄ‚îÄ LOG ‚îÄ‚îÄ */
.log-item{display:flex;gap:12px;padding:10px 0;border-bottom:1px solid var(--border);}
.log-item:last-child{border-bottom:none;}
.log-dot{width:8px;height:8px;background:var(--g300);border-radius:50%;margin-top:6px;flex-shrink:0;}
.log-content{flex:1;}
.log-action{font-size:13px;font-weight:600;color:var(--text-1);}
.log-detail{font-size:12px;color:var(--text-3);margin-top:2px;}
.log-time{font-size:11px;color:var(--text-3);margin-top:2px;}

.empty-state{text-align:center;padding:40px 20px;color:var(--text-3);}
.empty-state .empty-icon{font-size:48px;margin-bottom:12px;}
.empty-state p{font-size:14px;}
.divider{height:1px;background:var(--border);margin:4px 0 16px;}

@media(min-width:600px){
  .stats-grid{grid-template-columns:repeat(4,1fr);}
  .drone-status-row{grid-template-columns:repeat(4,1fr);}
  .main-content{max-width:680px;margin:0 auto;}
  .bottom-nav{max-width:680px;left:50%;transform:translateX(-50%);}
  .fab{right:calc(50% - 340px + 16px);}
}
</style>
</head>
<body>

<!-- AUTH -->
<div id="screen-auth" class="screen active">
  <div class="auth-card">
    <div class="auth-logo">
      <div class="logo-mark">üåø</div>
      <h1>FRUTE<span>SP</span></h1>
      <p>Gest√£o Operacional</p>
    </div>
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('login')">Entrar</button>
      <button class="auth-tab" onclick="switchTab('register')">Registrar-se</button>
    </div>

    <!-- LOGIN -->
    <div id="tab-login">
      <div id="login-error" class="error-msg"></div>
      <div class="form-group"><label>Email</label><input type="email" id="inp-email" placeholder="seu@frutesp.com"></div>
      <div class="form-group"><label>Senha</label><input type="password" id="inp-senha" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
      <button class="btn btn-primary" onclick="doLogin()">Entrar no Sistema</button>
    </div>

    <!-- REGISTRO -->
    <div id="tab-register" style="display:none;">
      <div id="reg-error" class="error-msg"></div>
      <div id="reg-success" class="success-msg"></div>
      <div class="form-group"><label>Nome Completo</label><input type="text" id="reg-nome" placeholder="Seu nome completo"></div>
      <div class="form-group"><label>Email</label><input type="email" id="reg-email" placeholder="seu@frutesp.com"></div>
      <div class="form-row">
        <div class="form-group"><label>Setor</label>
          <select id="reg-setor"><option>Produ√ß√£o</option><option>Mec√¢nica</option><option>Irriga√ß√£o</option><option>Packing House</option><option>Opera√ß√µes Drone</option><option>Administrativo</option></select>
        </div>
        <div class="form-group"><label>Perfil</label>
          <select id="reg-perfil"><option value="Solicitante">Solicitante</option><option value="Atendente">Atendente</option></select>
        </div>
      </div>
      <div class="form-group"><label>Senha</label><input type="password" id="reg-senha" placeholder="M√≠n. 6 caracteres"></div>
      <div class="form-group"><label>Confirmar Senha</label><input type="password" id="reg-confirm" placeholder="Repita a senha"></div>
      <button class="btn btn-primary" onclick="doRegister()">Criar Conta</button>
      <p style="text-align:center;font-size:12px;color:var(--text-3);margin-top:12px;">Acesso de Gestor √© configurado pelo administrador do sistema.</p>
    </div>
  </div>
</div>

<!-- APP -->
<div id="screen-app" class="screen">
  <div class="topbar">
    <div class="topbar-logo">FRUTE<span>SP</span></div>
    <div class="topbar-badge" id="topbar-badge"></div>
    <div class="topbar-avatar" id="topbar-avatar" onclick="navTo('perfil')"></div>
  </div>

  <div class="main-content">
    <!-- DASHBOARD -->
    <div id="page-dashboard" class="page active">
      <div class="page-header"><h2 id="dash-title">Dashboard</h2></div>
      <div class="stats-grid" id="stats-grid"></div>
      <div class="section-label">Tickets por Setor</div>
      <div class="chart-card"><div class="bar-chart" id="bar-setor"></div></div>
      <div class="section-label">Ranking de Falhas ‚Äì Equipamentos</div>
      <div class="chart-card"><div class="bar-chart" id="bar-equip"></div></div>
    </div>

    <!-- TICKETS -->
    <div id="page-tickets" class="page">
      <div class="page-header"><h2>Chamados</h2><span id="tickets-count" class="badge badge-status-OPEN"></span></div>
      <div class="ticket-filters">
        <div class="filter-chip active" onclick="filterTickets('todos',this)">Todos</div>
        <div class="filter-chip" onclick="filterTickets('OPEN',this)">Abertos</div>
        <div class="filter-chip" onclick="filterTickets('IN_PROGRESS',this)">Em andamento</div>
        <div class="filter-chip" onclick="filterTickets('WAITING',this)">Aguardando</div>
        <div class="filter-chip" onclick="filterTickets('DONE',this)">Conclu√≠dos</div>
        <div class="filter-chip" onclick="filterTickets('sla',this)">‚ö† SLA Vencido</div>
      </div>
      <div class="ticket-list" id="ticket-list"></div>
    </div>

    <!-- CHAT -->
    <div id="page-chat" class="page" style="padding:0;">
      <div style="padding:16px 16px 0;">
        <div class="page-header" style="margin-bottom:12px;"><h2>Chat por Setor</h2></div>
        <div class="sector-tabs" id="sector-tabs"></div>
      </div>
      <div class="chat-messages" id="sector-chat-msgs" style="max-height:calc(100vh - 240px);padding:12px 16px;"></div>
      <div class="chat-input-area">
        <textarea id="sector-chat-input" placeholder="Digite uma mensagem..." rows="1"></textarea>
        <button class="chat-send-btn" onclick="sendSectorMsg()">‚û§</button>
      </div>
    </div>

    <!-- DRONE -->
    <div id="page-drone" class="page">
      <div class="drone-header-card">
        <div class="drone-icon-big">üöÅ</div>
        <div class="drone-header-text"><h3>Opera√ß√µes de Drone</h3><p>Frota, miss√µes e monitoramento a√©reo</p></div>
      </div>
      <button class="btn btn-primary" style="margin-bottom:16px;" onclick="openModalMissao()">üìç Registrar Nova Miss√£o</button>
      <div class="drone-status-row" id="drone-stats"></div>
      <div class="section-label">Frota de Drones</div>
      <div id="drone-list"></div>
      <div class="section-label" style="margin-top:16px;">Hist√≥rico de Miss√µes</div>
      <div id="mission-list"></div>
    </div>

    <!-- EQUIPAMENTOS -->
    <div id="page-equip" class="page">
      <div class="page-header"><h2>Equipamentos</h2><button class="btn btn-secondary btn-sm" id="btn-add-equip" onclick="openModal('modal-equip')">+ Novo</button></div>
      <div id="equip-list"></div>
    </div>

    <!-- PERFIL -->
    <div id="page-perfil" class="page">
      <div class="profile-banner">
        <div class="profile-avatar-lg" id="perfil-avatar"></div>
        <div><div class="profile-name" id="perfil-name"></div><div class="profile-role" id="perfil-role"></div><div class="profile-setor" id="perfil-setor"></div></div>
      </div>
      <div class="section-label">Configura√ß√µes</div>
      <button class="menu-item" id="btn-admin" onclick="openAdminPanel()" style="display:none;"><span class="mi-icon">‚öôÔ∏è</span><span class="mi-label">Painel Administrativo</span><span class="mi-arrow">‚Ä∫</span></button>
      <button class="menu-item" onclick="openModal('modal-drone')"><span class="mi-icon">üöÅ</span><span class="mi-label">Cadastrar Drone</span><span class="mi-arrow">‚Ä∫</span></button>
      <button class="menu-item" onclick="openRelatorio()"><span class="mi-icon">üìä</span><span class="mi-label">Relat√≥rio Geral</span><span class="mi-arrow">‚Ä∫</span></button>
      <div class="divider"></div>
      <button class="menu-item" onclick="doLogout()" style="border-color:var(--red-bg);"><span class="mi-icon">üö™</span><span class="mi-label" style="color:var(--red);">Sair do Sistema</span><span class="mi-arrow">‚Ä∫</span></button>
    </div>
  </div>

  <nav class="bottom-nav">
    <button class="nav-item active" onclick="navTo('dashboard')"><span class="nav-icon">üìä</span>Painel</button>
    <button class="nav-item" onclick="navTo('tickets')"><span class="nav-icon">üìã</span>Chamados<span class="nav-badge" id="nav-badge" style="display:none;"></span></button>
    <button class="nav-item" onclick="navTo('chat')"><span class="nav-icon">üí¨</span>Chat</button>
    <button class="nav-item" onclick="navTo('drone')"><span class="nav-icon">üöÅ</span>Drone</button>
    <button class="nav-item" onclick="navTo('equip')"><span class="nav-icon">üîß</span>Equip.</button>
    <button class="nav-item" onclick="navTo('perfil')"><span class="nav-icon">üë§</span>Perfil</button>
  </nav>
  <button class="fab" id="fab-btn" onclick="openModalTicket()" style="display:none;">+</button>
</div>

<!-- TICKET DETAIL -->
<div id="ticket-detail-overlay" style="display:none;position:fixed;inset:0;background:var(--g800);z-index:250;overflow-y:auto;flex-direction:column;">
  <div class="detail-header">
    <button class="btn-icon" onclick="closeDetail()">‚Üê</button>
    <h3 id="detail-proto">Chamado</h3>
    <div id="detail-status-badge"></div>
  </div>
  <div class="detail-body">
    <div class="detail-section">
      <h4>Informa√ß√µes Gerais</h4>
      <div class="detail-row"><span class="dr-label">T√≠tulo</span><span class="dr-value" id="d-titulo"></span></div>
      <div class="detail-row"><span class="dr-label">Categoria</span><span class="dr-value" id="d-categoria"></span></div>
      <div class="detail-row"><span class="dr-label">Prioridade</span><span class="dr-value" id="d-prioridade"></span></div>
      <div class="detail-row"><span class="dr-label">Setor</span><span class="dr-value" id="d-setor"></span></div>
      <div class="detail-row"><span class="dr-label">Local</span><span class="dr-value" id="d-local"></span></div>
      <div class="detail-row"><span class="dr-label">Equipamento</span><span class="dr-value" id="d-equip"></span></div>
      <div class="detail-row"><span class="dr-label">Impacto</span><span class="dr-value" id="d-impacto"></span></div>
      <div class="detail-row"><span class="dr-label">Parada</span><span class="dr-value" id="d-parada"></span></div>
    </div>
    <div class="detail-section"><h4>Descri√ß√£o</h4><p style="font-size:14px;color:var(--text-2);line-height:1.7;" id="d-descricao"></p></div>
    <div class="detail-section">
      <h4>Datas & SLA</h4>
      <div class="detail-row"><span class="dr-label">Abertura</span><span class="dr-value" id="d-abertura"></span></div>
      <div class="detail-row"><span class="dr-label">Prazo SLA</span><span class="dr-value" id="d-sla"></span></div>
      <div class="detail-row"><span class="dr-label">Respons√°vel</span><span class="dr-value" id="d-responsavel"></span></div>
      <div class="detail-row"><span class="dr-label">Solicitante</span><span class="dr-value" id="d-solicitante"></span></div>
    </div>
    <div class="detail-section" style="padding-bottom:0;">
      <h4>Mensagens do Chamado</h4>
      <div class="chat-messages" id="ticket-chat-msgs" style="min-height:80px;max-height:30vh;"></div>
    </div>
    <div class="chat-input-area" style="background:var(--surface-card);margin-bottom:12px;border-radius:0 0 var(--radius) var(--radius);">
      <textarea id="ticket-chat-input" placeholder="Responder ao chamado..." rows="1"></textarea>
      <button class="chat-send-btn" onclick="sendTicketMsg()">‚û§</button>
    </div>
    <div class="detail-section"><h4>Hist√≥rico</h4><div id="ticket-history"></div></div>
  </div>
  <div class="action-bar" id="detail-actions"></div>
</div>

<!-- MODAL TICKET -->
<div class="modal-overlay" id="modal-ticket">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">üé´ Novo Chamado</div>
    <div class="form-group"><label>T√≠tulo</label><input type="text" id="nt-titulo" placeholder="Descreva brevemente o problema"></div>
    <div class="form-group"><label>Descri√ß√£o</label><textarea id="nt-descricao" placeholder="Detalhes do problema..."></textarea></div>
    <div class="form-row">
      <div class="form-group"><label>Categoria</label>
        <select id="nt-categoria"><option>Corretiva</option><option>Preventiva</option><option>Emergencial</option><option>Administrativa</option></select>
      </div>
      <div class="form-group"><label>Prioridade</label>
        <select id="nt-prioridade"><option value="baixa">Baixa</option><option value="media">M√©dia</option><option value="alta">Alta</option><option value="critica">Cr√≠tica</option></select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Setor</label>
        <select id="nt-setor"><option>Produ√ß√£o</option><option>Mec√¢nica</option><option>Irriga√ß√£o</option><option>Packing House</option><option>Opera√ß√µes Drone</option><option>Administrativo</option></select>
      </div>
      <div class="form-group"><label>Local</label>
        <select id="nt-local"><option>Talh√£o A</option><option>Talh√£o B</option><option>Talh√£o C</option><option>Packing House</option><option>C√¢mara Fria</option><option>Oficina</option><option>Escrit√≥rio</option></select>
      </div>
    </div>
    <div class="form-group"><label>Equipamento (opcional)</label><select id="nt-equip"><option value="">‚Äî Nenhum ‚Äî</option></select></div>
    <div class="form-row">
      <div class="form-group"><label>Impacto</label>
        <select id="nt-impacto"><option>Baixo</option><option>M√©dio</option><option>Alto</option></select>
      </div>
      <div class="form-group"><label>Parada (min)</label><input type="number" id="nt-parada" value="0" min="0"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('modal-ticket')">Cancelar</button>
      <button class="btn btn-primary" style="flex:2;" onclick="submitTicket()">Abrir Chamado</button>
    </div>
  </div>
</div>

<!-- MODAL DRONE -->
<div class="modal-overlay" id="modal-drone">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">üöÅ Cadastrar Drone</div>
    <div class="form-group"><label>Nome / Modelo</label><input type="text" id="dr-nome" placeholder="Ex: DJI Agras T40"></div>
    <div class="form-row">
      <div class="form-group"><label>C√≥digo</label><input type="text" id="dr-codigo" placeholder="DRN-001"></div>
      <div class="form-group"><label>Tipo</label>
        <select id="dr-tipo"><option>Pulveriza√ß√£o</option><option>Mapeamento</option><option>Monitoramento</option><option>Multifun√ß√£o</option></select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Horas de voo</label><input type="number" id="dr-horas" value="0" min="0"></div>
      <div class="form-group"><label>Status</label>
        <select id="dr-status"><option value="disponivel">Dispon√≠vel</option><option value="missao">Em Miss√£o</option><option value="manutencao">Manuten√ß√£o</option><option value="inativo">Inativo</option></select>
      </div>
    </div>
    <div class="form-group"><label>Piloto Respons√°vel</label><input type="text" id="dr-piloto" placeholder="Nome do piloto"></div>
    <div class="form-group"><label>Observa√ß√µes</label><textarea id="dr-obs" placeholder="Capacidade, autonomia, √°rea coberta por voo..."></textarea></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('modal-drone')">Cancelar</button>
      <button class="btn btn-primary" style="flex:2;" onclick="submitDrone()">Cadastrar Drone</button>
    </div>
  </div>
</div>

<!-- MODAL MISS√ÉO -->
<div class="modal-overlay" id="modal-missao">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">üìç Registrar Miss√£o</div>
    <div class="form-group"><label>Drone</label><select id="ms-drone"></select></div>
    <div class="form-group"><label>Tipo de Miss√£o</label>
      <select id="ms-tipo"><option>Pulveriza√ß√£o</option><option>Mapeamento de √°rea</option><option>Monitoramento de pragas</option><option>Inspe√ß√£o de lavoura</option><option>Levantamento topogr√°fico</option><option>Contagem de plantas</option></select>
    </div>
    <div class="form-row">
      <div class="form-group"><label>√Årea coberta (ha)</label><input type="number" id="ms-area" value="0" step="0.1" min="0"></div>
      <div class="form-group"><label>Dura√ß√£o (min)</label><input type="number" id="ms-duracao" value="30" min="1"></div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Local / Talh√£o</label>
        <select id="ms-local"><option>Talh√£o A</option><option>Talh√£o B</option><option>Talh√£o C</option><option>√Årea Total</option></select>
      </div>
      <div class="form-group"><label>Piloto</label><input type="text" id="ms-piloto" placeholder="Nome do piloto"></div>
    </div>
    <div class="form-group"><label>Observa√ß√µes</label><textarea id="ms-obs" placeholder="Condi√ß√µes clim√°ticas, intercorr√™ncias..."></textarea></div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('modal-missao')">Cancelar</button>
      <button class="btn btn-primary" style="flex:2;" onclick="submitMissao()">Registrar Miss√£o</button>
    </div>
  </div>
</div>

<!-- MODAL EQUIP -->
<div class="modal-overlay" id="modal-equip">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">üîß Novo Equipamento</div>
    <div class="form-group"><label>Nome</label><input type="text" id="eq-nome" placeholder="Nome do equipamento"></div>
    <div class="form-row">
      <div class="form-group"><label>C√≥digo</label><input type="text" id="eq-cod" placeholder="TR-001"></div>
      <div class="form-group"><label>Tipo</label>
        <select id="eq-tipo"><option>Trator</option><option>Pulverizador</option><option>Bomba</option><option>Esteira</option><option>C√¢mara Fria</option><option>Outro</option></select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Setor</label>
        <select id="eq-setor"><option>Produ√ß√£o</option><option>Mec√¢nica</option><option>Irriga√ß√£o</option><option>Packing House</option><option>Administrativo</option></select>
      </div>
      <div class="form-group"><label>Local</label>
        <select id="eq-local"><option>Talh√£o A</option><option>Talh√£o B</option><option>Packing House</option><option>C√¢mara Fria</option><option>Oficina</option></select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group"><label>Hor√≠metro (h)</label><input type="number" id="eq-hor" value="0" min="0"></div>
      <div class="form-group"><label>Status</label>
        <select id="eq-status"><option value="ativo">Ativo</option><option value="manutencao">Manuten√ß√£o</option><option value="inativo">Inativo</option></select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeModal('modal-equip')">Cancelar</button>
      <button class="btn btn-primary" style="flex:2;" onclick="submitEquip()">Cadastrar</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
'use strict';
const SLA_H={baixa:72,media:48,alta:24,critica:6};
const EQ_ICON={Trator:'üöú',Pulverizador:'üåø',Bomba:'üíß',Esteira:'‚öôÔ∏è','C√¢mara Fria':'üßä',Outro:'üî©'};
const DR_ICON={Pulveriza√ß√£o:'üíä',Mapeamento:'üó∫Ô∏è',Monitoramento:'üëÅÔ∏è',Multifun√ß√£o:'üöÅ'};
const SL={OPEN:'Aberto',IN_PROGRESS:'Em Andamento',WAITING:'Aguardando',DONE:'Conclu√≠do',CANCELED:'Cancelado'};
const DSL={disponivel:'Dispon√≠vel',missao:'Em Miss√£o',manutencao:'Manuten√ß√£o',inativo:'Inativo'};
const DSC={disponivel:'var(--g150)',missao:'var(--blue)',manutencao:'var(--orange)',inativo:'var(--text-3)'};
const DSB={disponivel:'rgba(43,168,123,.15)',missao:'var(--bl-bg)',manutencao:'var(--or-bg)',inativo:'rgba(255,255,255,.05)'};

let CU=null,users=[],tickets=[],equip=[],drones=[],missoes=[],chats={};
let TC=1000,MC=100,curTicket=null,curSector=null,curFilter='todos';

function save(){try{localStorage.setItem('fsp_u',JSON.stringify(users));localStorage.setItem('fsp_t',JSON.stringify(tickets));localStorage.setItem('fsp_e',JSON.stringify(equip));localStorage.setItem('fsp_d',JSON.stringify(drones));localStorage.setItem('fsp_m',JSON.stringify(missoes));localStorage.setItem('fsp_c',JSON.stringify(chats));localStorage.setItem('fsp_tc',TC);localStorage.setItem('fsp_mc',MC);}catch(e){}}
function load(){try{users=JSON.parse(localStorage.getItem('fsp_u'))||[];tickets=JSON.parse(localStorage.getItem('fsp_t'))||[];equip=JSON.parse(localStorage.getItem('fsp_e'))||[];drones=JSON.parse(localStorage.getItem('fsp_d'))||[];missoes=JSON.parse(localStorage.getItem('fsp_m'))||[];chats=JSON.parse(localStorage.getItem('fsp_c'))||{};TC=parseInt(localStorage.getItem('fsp_tc'))||1000;MC=parseInt(localStorage.getItem('fsp_mc'))||100;}catch(e){users=[];tickets=[];equip=[];drones=[];missoes=[];chats={};}ensureMaykon();}
function ensureMaykon(){if(!users.find(u=>u.email==='maykons@frutesp.com')){users.push({id:1,email:'maykons@frutesp.com',senha:'#Mds2026',nome:'Maykon Santos',perfil:'Gestor',setor:'Gest√£o',avatar:'MS',ativo:true});save();}}
function ensureChans(){['Produ√ß√£o','Mec√¢nica','Irriga√ß√£o','Packing House','Opera√ß√µes Drone','Gest√£o'].forEach(s=>{if(!chats[s])chats[s]=[];});}

/* AUTH */
function switchTab(t){document.getElementById('tab-login').style.display=t==='login'?'':'none';document.getElementById('tab-register').style.display=t==='register'?'':'none';document.querySelectorAll('.auth-tab').forEach((el,i)=>el.classList.toggle('active',(i===0&&t==='login')||(i===1&&t==='register')));}
function doLogin(){const email=document.getElementById('inp-email').value.trim().toLowerCase();const senha=document.getElementById('inp-senha').value;const err=document.getElementById('login-error');const u=users.find(x=>x.email.toLowerCase()===email&&x.senha===senha);if(!u){err.textContent='Email ou senha incorretos.';err.style.display='block';return;}err.style.display='none';CU=u;document.getElementById('screen-auth').classList.remove('active');document.getElementById('screen-app').classList.add('active');initApp();}
function doRegister(){const nome=document.getElementById('reg-nome').value.trim();const email=document.getElementById('reg-email').value.trim().toLowerCase();const setor=document.getElementById('reg-setor').value;const perfil=document.getElementById('reg-perfil').value;const senha=document.getElementById('reg-senha').value;const confirm=document.getElementById('reg-confirm').value;const err=document.getElementById('reg-error');const suc=document.getElementById('reg-success');err.style.display='none';suc.style.display='none';if(!nome||!email||!senha){err.textContent='Preencha todos os campos.';err.style.display='block';return;}if(senha.length<6){err.textContent='Senha deve ter no m√≠nimo 6 caracteres.';err.style.display='block';return;}if(senha!==confirm){err.textContent='As senhas n√£o coincidem.';err.style.display='block';return;}if(users.find(x=>x.email.toLowerCase()===email)){err.textContent='Este email j√° est√° cadastrado.';err.style.display='block';return;}const initials=nome.split(' ').slice(0,2).map(w=>w[0]).join('').toUpperCase();users.push({id:Date.now(),email,senha,nome,perfil,setor,avatar:initials,ativo:true});save();suc.textContent='‚úÖ Conta criada! Fa√ßa login para acessar.';suc.style.display='block';['reg-nome','reg-email','reg-senha','reg-confirm'].forEach(id=>document.getElementById(id).value='');setTimeout(()=>switchTab('login'),1800);}
function doLogout(){CU=null;document.getElementById('screen-app').classList.remove('active');document.getElementById('screen-auth').classList.add('active');document.getElementById('inp-email').value='';document.getElementById('inp-senha').value='';switchTab('login');}

/* INIT */
function initApp(){ensureChans();document.getElementById('topbar-avatar').textContent=CU.avatar;document.getElementById('topbar-badge').textContent=CU.perfil;document.getElementById('perfil-avatar').textContent=CU.avatar;document.getElementById('perfil-name').textContent=CU.nome;document.getElementById('perfil-role').textContent=CU.perfil;document.getElementById('perfil-setor').textContent=CU.setor;const g=CU.perfil==='Gestor';document.getElementById('btn-admin').style.display=g?'':'none';document.getElementById('btn-add-equip').style.display=g?'':'none';renderAll();navTo('dashboard');}
function renderAll(){renderDash();renderTickets(curFilter);renderEquip();renderDrone();initChat();updateBadge();}

/* NAV */
function navTo(p){document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));const el=document.getElementById('page-'+p);if(el)el.classList.add('active');const pages=['dashboard','tickets','chat','drone','equip','perfil'];const idx=pages.indexOf(p);if(idx>=0)document.querySelectorAll('.nav-item')[idx].classList.add('active');document.getElementById('fab-btn').style.display=['tickets','dashboard'].includes(p)?'flex':'none';}

/* DASHBOARD */
function getVis(){if(CU.perfil==='Gestor')return tickets;if(CU.perfil==='Atendente')return tickets.filter(t=>t.setor===CU.setor);return tickets.filter(t=>t.criadoPorId===CU.id);}
function isSLA(t){return Date.now()>t.slaDeadline&&!['DONE','CANCELED'].includes(t.status);}
function renderDash(){const my=getVis();const open=my.filter(t=>!['DONE','CANCELED'].includes(t.status));const crit=my.filter(t=>t.prioridade==='critica'&&!['DONE','CANCELED'].includes(t.status));const slav=my.filter(isSLA);const done=my.filter(t=>t.status==='DONE');const pct=done.length?Math.round(done.filter(t=>!isSLA(t)).length/done.length*100):100;document.getElementById('dash-title').textContent=CU.perfil==='Gestor'?'Dashboard Geral':`Dashboard ‚Äì ${CU.setor}`;document.getElementById('stats-grid').innerHTML=`<div class="stat-card green"><span class="stat-icon">üìã</span><div class="stat-value">${open.length}</div><div class="stat-label">Chamados Abertos</div></div><div class="stat-card red"><span class="stat-icon">üö®</span><div class="stat-value">${crit.length}</div><div class="stat-label">Cr√≠ticos Ativos</div></div><div class="stat-card orange"><span class="stat-icon">‚ö†Ô∏è</span><div class="stat-value">${slav.length}</div><div class="stat-label">SLA Vencido</div></div><div class="stat-card blue"><span class="stat-icon">‚úÖ</span><div class="stat-value">${pct}%</div><div class="stat-label">SLA Cumprido</div></div>`;const sets=['Produ√ß√£o','Mec√¢nica','Irriga√ß√£o','Packing House','Drone','Administrativo'];const mS=s=>s==='Drone'?'Opera√ß√µes Drone':s;const maxS=Math.max(...sets.map(s=>my.filter(t=>t.setor===mS(s)).length),1);document.getElementById('bar-setor').innerHTML=sets.map(s=>{const c=my.filter(t=>t.setor===mS(s)).length;return`<div class="bar-row"><div class="bar-label">${s}</div><div class="bar-track"><div class="bar-fill" style="width:${c/maxS*100}%;background:var(--g300)"></div></div><div class="bar-val">${c}</div></div>`;}).join('');const eMap={};my.forEach(t=>{if(t.equip)eMap[t.equip]=(eMap[t.equip]||0)+1;});const eArr=Object.entries(eMap).sort((a,b)=>b[1]-a[1]).slice(0,5);const maxE=eArr.length?eArr[0][1]:1;document.getElementById('bar-equip').innerHTML=eArr.length?eArr.map(([k,v])=>`<div class="bar-row"><div class="bar-label">${k.split('‚Äì')[0].trim()}</div><div class="bar-track"><div class="bar-fill" style="width:${v/maxE*100}%;background:var(--orange)"></div></div><div class="bar-val">${v}</div></div>`).join(''):'<p style="color:var(--text-3);font-size:13px;">Nenhuma ocorr√™ncia por equipamento.</p>';}

/* TICKETS */
function filterTickets(f,el){curFilter=f;document.querySelectorAll('.filter-chip').forEach(c=>c.classList.remove('active'));if(el)el.classList.add('active');renderTickets(f);}
function renderTickets(f){let list=getVis();if(f==='sla')list=list.filter(isSLA);else if(f!=='todos')list=list.filter(t=>t.status===f);const pri={critica:0,alta:1,media:2,baixa:3};list.sort((a,b)=>(pri[a.prioridade]||2)-(pri[b.prioridade]||2)||b.criadoEm-a.criadoEm);document.getElementById('tickets-count').textContent=list.length;if(!list.length){document.getElementById('ticket-list').innerHTML='<div class="empty-state"><div class="empty-icon">üì≠</div><p>Nenhum chamado encontrado.</p></div>';return;}document.getElementById('ticket-list').innerHTML=list.map(t=>{const v=isSLA(t);const tot=t.slaDeadline-t.criadoEm;const pct=Math.min(100,Math.round((Date.now()-t.criadoEm)/tot*100));const fc=v?'var(--red)':pct>70?'var(--orange)':'var(--g200)';const isDr=t.setor==='Opera√ß√µes Drone';return`<div class="ticket-card priority-${t.prioridade} ${v?'sla-vencido':''}" onclick="openDetail(${t.id})"><div class="ticket-top"><span class="ticket-proto">${t.proto}</span><div style="display:flex;gap:4px;">${v?'<span class="badge badge-sla">‚ö† SLA</span>':''}${isDr?'<span class="badge badge-drone">üöÅ</span>':''}</div></div><div class="ticket-title">${t.titulo}</div><div class="ticket-meta"><span class="badge badge-status-${t.status}">${SL[t.status]||t.status}</span><span class="badge badge-priority-${t.prioridade}">${cap(t.prioridade)}</span><span class="badge badge-setor">${t.setor}</span></div><div class="ticket-sla-bar"><div class="ticket-sla-fill" style="width:${pct}%;background:${fc}"></div></div></div>`;}).join('');}
function updateBadge(){const c=getVis().filter(t=>t.status==='OPEN').length;const b=document.getElementById('nav-badge');b.textContent=c;b.style.display=c>0?'flex':'none';}

/* DETAIL */
function openDetail(id){const t=tickets.find(x=>x.id===id);if(!t)return;curTicket=id;document.getElementById('detail-proto').textContent=t.proto;document.getElementById('detail-status-badge').innerHTML=`<span class="badge badge-status-${t.status}">${SL[t.status]}</span>`;['titulo','categoria','setor','local','impacto'].forEach(k=>document.getElementById('d-'+k).textContent=t[k]||'‚Äì');document.getElementById('d-prioridade').innerHTML=`<span class="badge badge-priority-${t.prioridade}">${cap(t.prioridade)}</span>`;document.getElementById('d-equip').textContent=t.equip||'‚Äì';document.getElementById('d-parada').textContent=(t.parada||0)+' min';document.getElementById('d-descricao').textContent=t.descricao||'‚Äî';document.getElementById('d-abertura').textContent=fmtDate(t.criadoEm);document.getElementById('d-sla').innerHTML=`${fmtDate(t.slaDeadline)} ${isSLA(t)?'<span class="badge badge-sla">Vencido</span>':''}`;const resp=users.find(u=>u.id===t.responsavelId);const sol=users.find(u=>u.id===t.criadoPorId);document.getElementById('d-responsavel').textContent=resp?resp.nome:'N√£o atribu√≠do';document.getElementById('d-solicitante').textContent=sol?sol.nome:'‚Äì';renderTChat(t);renderTHistory(t);renderActions(t);const ov=document.getElementById('ticket-detail-overlay');ov.style.display='flex';ov.scrollTop=0;}
function closeDetail(){document.getElementById('ticket-detail-overlay').style.display='none';curTicket=null;}
function renderTChat(t){const el=document.getElementById('ticket-chat-msgs');el.innerHTML=t.chat&&t.chat.length?t.chat.map(m=>{const mine=m.userId===CU.id;return`<div class="chat-msg ${mine?'mine':'other'}"><div class="chat-bubble">${esc(m.msg)}</div><div class="chat-meta">${m.userName} ¬∑ ${fmtTime(m.ts)}</div></div>`;}).join(''):'<p style="color:var(--text-3);font-size:13px;text-align:center;padding:16px;">Nenhuma mensagem ainda.</p>';el.scrollTop=el.scrollHeight;}
function sendTicketMsg(){const inp=document.getElementById('ticket-chat-input');const msg=inp.value.trim();if(!msg||!curTicket)return;const t=tickets.find(x=>x.id===curTicket);if(!t.chat)t.chat=[];t.chat.push({userId:CU.id,userName:CU.nome,msg,ts:Date.now()});inp.value='';renderTChat(t);save();}
function renderTHistory(t){document.getElementById('ticket-history').innerHTML=(t.history||[]).slice().reverse().map(h=>{const u=users.find(x=>x.id===h.usuario);return`<div class="log-item"><div class="log-dot"></div><div class="log-content"><div class="log-action">${h.acao}</div>${h.de?`<div class="log-detail">${h.de} ‚Üí ${h.para}</div>`:''}<div class="log-time">${u?u.nome:'‚Äì'} ¬∑ ${fmtDate(h.ts)}</div></div></div>`;}).join('');}
function renderActions(t){const bar=document.getElementById('detail-actions');bar.innerHTML='';if(['DONE','CANCELED'].includes(t.status)){bar.innerHTML='<p style="color:var(--text-3);font-size:13px;text-align:center;width:100%;">Chamado encerrado</p>';return;}const p=CU.perfil;if(p==='Atendente'){if(t.status==='OPEN')bar.innerHTML=`<button class="btn btn-secondary" onclick="changeStatus('IN_PROGRESS')">‚ñ∂ Assumir Chamado</button>`;if(t.status==='IN_PROGRESS')bar.innerHTML=`<button class="btn btn-secondary" onclick="changeStatus('WAITING')">‚è∏ Aguardar</button><button class="btn btn-primary" onclick="changeStatus('DONE')">‚úÖ Concluir</button>`;if(t.status==='WAITING')bar.innerHTML=`<button class="btn btn-primary" onclick="changeStatus('IN_PROGRESS')">‚ñ∂ Retomar</button>`;}if(p==='Gestor'){bar.innerHTML=`<select id="sel-st" style="flex:1;padding:12px;background:var(--g600);color:var(--text-1);border:1px solid var(--border-md);border-radius:var(--radius-sm);font-family:inherit;font-size:14px;">${Object.entries(SL).map(([k,v])=>`<option value="${k}" ${t.status===k?'selected':''}>${v}</option>`).join('')}<option value="CANCELED">Cancelar</option></select><button class="btn btn-primary" style="flex:1;" onclick="changeStatus(document.getElementById('sel-st').value)">Aplicar</button>`;}}
function changeStatus(ns){const t=tickets.find(x=>x.id===curTicket);if(!t)return;const old=t.status;t.status=ns;if(!t.history)t.history=[];t.history.push({acao:'Status alterado',de:SL[old],para:SL[ns]||ns,usuario:CU.id,ts:Date.now()});save();toast(`Status: ${SL[ns]||ns}`);openDetail(curTicket);renderTickets(curFilter);renderDash();updateBadge();}

/* NEW TICKET */
function openModalTicket(){const sel=document.getElementById('nt-equip');sel.innerHTML='<option value="">‚Äî Nenhum ‚Äî</option>';equip.forEach(e=>{const o=document.createElement('option');o.value=e.codigo+' ‚Äì '+e.nome;o.textContent=o.value;sel.appendChild(o);});openModal('modal-ticket');}
function submitTicket(){const titulo=document.getElementById('nt-titulo').value.trim();if(!titulo){toast('Informe o t√≠tulo!');return;}TC++;const pri=document.getElementById('nt-prioridade').value;const ts=Date.now();const t={id:TC,proto:`#FRU-${TC}`,titulo,descricao:document.getElementById('nt-descricao').value.trim(),categoria:document.getElementById('nt-categoria').value,prioridade:pri,setor:document.getElementById('nt-setor').value,local:document.getElementById('nt-local').value,equip:document.getElementById('nt-equip').value,impacto:document.getElementById('nt-impacto').value,parada:parseInt(document.getElementById('nt-parada').value)||0,criadoPorId:CU.id,criadoEm:ts,status:'OPEN',responsavelId:null,slaDeadline:ts+SLA_H[pri]*3600000,chat:[],history:[{acao:'Chamado aberto',de:null,para:'OPEN',usuario:CU.id,ts}]};tickets.unshift(t);save();closeModal('modal-ticket');document.getElementById('nt-titulo').value='';document.getElementById('nt-descricao').value='';toast(`‚úÖ ${t.proto} aberto!`);curFilter='todos';document.querySelectorAll('.filter-chip').forEach((c,i)=>c.classList.toggle('active',i===0));renderTickets('todos');renderDash();updateBadge();navTo('tickets');}

/* EQUIP */
function renderEquip(){const list=CU.perfil==='Gestor'?equip:equip.filter(e=>e.setor===CU.setor);document.getElementById('equip-list').innerHTML=list.length?list.map(e=>{const icon=EQ_ICON[e.tipo]||'üî©';const oc=tickets.filter(t=>t.equip&&t.equip.includes(e.codigo)).length;return`<div class="equip-card"><div class="equip-icon">${icon}</div><div class="equip-info"><div class="equip-name">${e.nome}</div><div class="equip-sub">${e.codigo} ¬∑ ${e.tipo} ¬∑ ${e.setor}</div><div class="equip-sub">${e.horimetro?`‚è± ${e.horimetro}h ¬∑ `:''}${oc} ocorr√™ncia(s)</div></div><div class="equip-status ${e.status}">${e.status==='manutencao'?'Manuten√ß√£o':cap(e.status)}</div></div>`;}).join(''):'<div class="empty-state"><div class="empty-icon">üîß</div><p>Nenhum equipamento cadastrado.</p></div>';}
function submitEquip(){const nome=document.getElementById('eq-nome').value.trim();if(!nome){toast('Informe o nome!');return;}equip.push({id:Date.now(),nome,codigo:document.getElementById('eq-cod').value.trim()||'EQ-'+Date.now(),tipo:document.getElementById('eq-tipo').value,setor:document.getElementById('eq-setor').value,local:document.getElementById('eq-local').value,horimetro:parseInt(document.getElementById('eq-hor').value)||0,status:document.getElementById('eq-status').value});save();closeModal('modal-equip');document.getElementById('eq-nome').value='';renderEquip();toast('‚úÖ Equipamento cadastrado!');}

/* DRONE */
function renderDrone(){const tot=drones.length,disp=drones.filter(d=>d.status==='disponivel').length,em=drones.filter(d=>d.status==='missao').length,ha=missoes.reduce((s,m)=>s+(m.area||0),0).toFixed(1);document.getElementById('drone-stats').innerHTML=`<div class="drone-stat"><div class="ds-val">${tot}</div><div class="ds-lbl">Drones cadastrados</div></div><div class="drone-stat"><div class="ds-val" style="color:var(--g150)">${disp}</div><div class="ds-lbl">Dispon√≠veis</div></div><div class="drone-stat"><div class="ds-val" style="color:var(--blue)">${em}</div><div class="ds-lbl">Em miss√£o</div></div><div class="drone-stat"><div class="ds-val">${ha} ha</div><div class="ds-lbl">√Årea coberta</div></div>`;document.getElementById('drone-list').innerHTML=drones.length?drones.map(d=>{const icon=DR_ICON[d.tipo]||'üöÅ';const mM=missoes.filter(m=>m.droneId===d.id);const haTot=mM.reduce((s,m)=>s+(m.area||0),0).toFixed(1);return`<div class="drone-card"><div class="drone-card-top"><div class="drone-avatar">${icon}</div><div style="flex:1;"><div class="drone-card-name">${d.nome}</div><div class="drone-card-code">${d.codigo} ¬∑ ${d.tipo}</div></div><span class="badge" style="background:${DSB[d.status]||'rgba(255,255,255,.05)'};color:${DSC[d.status]||'var(--text-3)'};">${DSL[d.status]||d.status}</span></div><div class="drone-card-meta">${d.piloto?`<span class="badge badge-setor">üë§ ${d.piloto}</span>`:''}<span class="badge badge-drone">‚úàÔ∏è ${d.horas||0}h voo</span><span class="badge badge-setor">${mM.length} miss√£o(√µes)</span></div><div class="drone-card-stats"><div class="dcs-item"><div class="dcs-val">${mM.length}</div><div class="dcs-lbl">Miss√µes</div></div><div class="dcs-item"><div class="dcs-val">${haTot}</div><div class="dcs-lbl">Hectares</div></div><div class="dcs-item"><div class="dcs-val">${d.horas||0}h</div><div class="dcs-lbl">Horas voo</div></div></div></div>`;}).join(''):'<div class="empty-state"><div class="empty-icon">üöÅ</div><p>Nenhum drone cadastrado.<br>Acesse Perfil ‚Üí Cadastrar Drone.</p></div>';const sorted=[...missoes].sort((a,b)=>b.ts-a.ts);document.getElementById('mission-list').innerHTML=sorted.length?sorted.slice(0,20).map(m=>{const dr=drones.find(d=>d.id===m.droneId);return`<div class="mission-card"><div class="mission-title">üöÅ ${m.tipo}</div><div class="mission-meta"><span>üìç ${m.local}</span><span>${dr?dr.nome:'‚Äì'}</span><span>üìê ${m.area} ha</span><span>‚è± ${m.duracao} min</span>${m.piloto?`<span>üë§ ${m.piloto}</span>`:''}<span>üìÖ ${fmtShort(m.ts)}</span></div>${m.obs?`<p style="font-size:12px;color:var(--text-3);margin-top:6px;">${esc(m.obs)}</p>`:''}</div>`;}).join(''):'<div class="empty-state" style="padding:20px;"><div class="empty-icon" style="font-size:32px;">üìç</div><p>Nenhuma miss√£o registrada.</p></div>';}
function submitDrone(){const nome=document.getElementById('dr-nome').value.trim();if(!nome){toast('Informe o nome/modelo!');return;}drones.push({id:Date.now(),nome,codigo:document.getElementById('dr-codigo').value.trim()||'DRN-'+Date.now(),tipo:document.getElementById('dr-tipo').value,horas:parseFloat(document.getElementById('dr-horas').value)||0,status:document.getElementById('dr-status').value,piloto:document.getElementById('dr-piloto').value.trim(),obs:document.getElementById('dr-obs').value.trim()});save();closeModal('modal-drone');['dr-nome','dr-codigo','dr-piloto','dr-obs'].forEach(id=>document.getElementById(id).value='');document.getElementById('dr-horas').value='0';renderDrone();toast('‚úÖ Drone cadastrado!');}
function openModalMissao(){if(!drones.length){toast('Cadastre um drone primeiro!');return;}const sel=document.getElementById('ms-drone');sel.innerHTML=drones.map(d=>`<option value="${d.id}">${d.nome} (${d.codigo})</option>`).join('');openModal('modal-missao');}
function submitMissao(){const droneId=parseInt(document.getElementById('ms-drone').value);MC++;const dur=parseInt(document.getElementById('ms-duracao').value)||30;const area=parseFloat(document.getElementById('ms-area').value)||0;missoes.push({id:MC,droneId,tipo:document.getElementById('ms-tipo').value,area,duracao:dur,local:document.getElementById('ms-local').value,piloto:document.getElementById('ms-piloto').value.trim(),obs:document.getElementById('ms-obs').value.trim(),ts:Date.now()});const dr=drones.find(d=>d.id===droneId);if(dr)dr.horas=Math.round(((dr.horas||0)+dur/60)*10)/10;save();closeModal('modal-missao');['ms-piloto','ms-obs'].forEach(id=>document.getElementById(id).value='');document.getElementById('ms-area').value='0';renderDrone();toast('‚úÖ Miss√£o registrada!');}

/* CHAT */
function initChat(){ensureChans();const tabs=document.getElementById('sector-tabs');let sets=['Produ√ß√£o','Mec√¢nica','Irriga√ß√£o','Packing House','Opera√ß√µes Drone','Gest√£o'];if(CU.perfil!=='Gestor')sets=sets.filter(s=>s===CU.setor);if(!sets.length)sets=[CU.setor];tabs.innerHTML=sets.map((s,i)=>`<div class="sector-tab ${i===0?'active':''}" onclick="switchSector('${s}',this)">${s.replace(' House','')}</div>`).join('');curSector=sets[0];renderSChat();}
function switchSector(s,el){curSector=s;document.querySelectorAll('.sector-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');renderSChat();}
function renderSChat(){if(!chats[curSector])chats[curSector]=[];const el=document.getElementById('sector-chat-msgs');el.innerHTML=chats[curSector].length?chats[curSector].map(m=>{const mine=m.userId===CU.id;return`<div class="chat-msg ${mine?'mine':'other'}"><div class="chat-bubble">${esc(m.msg)}</div><div class="chat-meta">${m.userName} ¬∑ ${fmtTime(m.ts)}</div></div>`;}).join(''):'<p style="color:var(--text-3);font-size:13px;text-align:center;padding:24px;">Nenhuma mensagem ainda.</p>';el.scrollTop=el.scrollHeight;}
function sendSectorMsg(){const inp=document.getElementById('sector-chat-input');const msg=inp.value.trim();if(!msg)return;if(!chats[curSector])chats[curSector]=[];chats[curSector].push({userId:CU.id,userName:CU.nome,msg,ts:Date.now()});inp.value='';renderSChat();save();}

/* ADMIN */
function openAdminPanel(){if(CU.perfil!=='Gestor'){toast('Acesso restrito.');return;}const u=users.map(x=>`${x.nome} | ${x.perfil} | ${x.setor} | ${x.email}`).join('\n');alert(`üë• USU√ÅRIOS (${users.length})\n\n${u||'Nenhum'}`);}
function openRelatorio(){const my=getVis();alert(`üìä RELAT√ìRIO\n\nTickets: ${my.length}\nAbertos: ${my.filter(t=>!['DONE','CANCELED'].includes(t.status)).length}\nConclu√≠dos: ${my.filter(t=>t.status==='DONE').length}\nDrones: ${drones.length}\nMiss√µes: ${missoes.length}\nHectares cobertos: ${missoes.reduce((s,m)=>s+(m.area||0),0).toFixed(1)} ha\nEquipamentos: ${equip.length}\nParada total: ${my.reduce((s,t)=>s+(t.parada||0),0)} min`);}

/* MODALS */
function openModal(id){document.getElementById(id).classList.add('active');}
function closeModal(id){document.getElementById(id).classList.remove('active');}
document.querySelectorAll('.modal-overlay').forEach(ov=>ov.addEventListener('click',e=>{if(e.target===ov)ov.classList.remove('active');}));

/* UTILS */
function cap(s){return s?s.charAt(0).toUpperCase()+s.slice(1):'';}
function esc(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function fmtDate(ts){return new Date(ts).toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit'});}
function fmtShort(ts){return new Date(ts).toLocaleDateString('pt-BR',{day:'2-digit',month:'2-digit',year:'numeric'});}
function fmtTime(ts){return new Date(ts).toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});}
let toastT;
function toast(msg){const el=document.getElementById('toast');el.textContent=msg;el.classList.add('show');clearTimeout(toastT);toastT=setTimeout(()=>el.classList.remove('show'),2800);}

document.getElementById('sector-chat-input').addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendSectorMsg();}});
document.getElementById('ticket-chat-input').addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendTicketMsg();}});
document.getElementById('inp-email').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('inp-senha').focus();});
document.getElementById('inp-senha').addEventListener('keydown',e=>{if(e.key==='Enter')doLogin();});

/* BOOT */
load();
</script>
</body>
</html>
