<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FRUTESP ‚Äì Gest√£o Operacional</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --green-dark: #0B3D2E;
  --green-mid: #145C43;
  --green-accent: #1F7A5C;
  --green-light: #2BA87B;
  --green-pale: #E8F5EF;
  --bg: #F4F7F5;
  --white: #FFFFFF;
  --text: #1A2B24;
  --text-muted: #5A7268;
  --border: #D0E4DA;
  --red: #C0392B;
  --red-light: #FDECEA;
  --orange: #E67E22;
  --orange-light: #FEF5EC;
  --yellow: #F39C12;
  --yellow-light: #FEFAEC;
  --blue: #2980B9;
  --blue-light: #EBF5FB;
  --shadow: 0 2px 12px rgba(11,61,46,0.10);
  --shadow-lg: 0 8px 32px rgba(11,61,46,0.15);
  --radius: 14px;
  --radius-sm: 8px;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  font-size: 15px;
}
h1,h2,h3,h4 { font-family: 'Syne', sans-serif; }

/* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
.screen { display: none; min-height: 100vh; }
.screen.active { display: flex; flex-direction: column; }

/* ‚îÄ‚îÄ LOGIN ‚îÄ‚îÄ */
#screen-login {
  background: linear-gradient(160deg, var(--green-dark) 0%, var(--green-mid) 60%, var(--green-accent) 100%);
  align-items: center;
  justify-content: center;
  padding: 24px;
}
.login-card {
  background: var(--white);
  border-radius: 24px;
  padding: 40px 32px;
  width: 100%;
  max-width: 400px;
  box-shadow: var(--shadow-lg);
}
.login-logo {
  text-align: center;
  margin-bottom: 32px;
}
.login-logo .logo-icon {
  width: 64px; height: 64px;
  background: var(--green-dark);
  border-radius: 16px;
  display: inline-flex; align-items: center; justify-content: center;
  font-size: 30px;
  margin-bottom: 12px;
}
.login-logo h1 { font-size: 24px; color: var(--green-dark); letter-spacing: -0.5px; }
.login-logo p { color: var(--text-muted); font-size: 13px; margin-top: 4px; }
.form-group { margin-bottom: 16px; }
.form-group label { display: block; font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 6px; }
.form-group input, .form-group select, .form-group textarea {
  width: 100%;
  padding: 12px 14px;
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  font-family: 'DM Sans', sans-serif;
  font-size: 15px;
  color: var(--text);
  background: var(--white);
  transition: border-color 0.2s;
  outline: none;
}
.form-group input:focus, .form-group select:focus, .form-group textarea:focus {
  border-color: var(--green-accent);
}
.form-group textarea { resize: vertical; min-height: 80px; }
.btn {
  display: inline-flex; align-items: center; justify-content: center; gap: 8px;
  padding: 13px 20px;
  border-radius: var(--radius-sm);
  font-family: 'DM Sans', sans-serif;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  transition: all 0.2s;
  text-decoration: none;
}
.btn-primary {
  background: var(--green-dark);
  color: var(--white);
  width: 100%;
}
.btn-primary:hover { background: var(--green-mid); }
.btn-secondary {
  background: var(--green-pale);
  color: var(--green-dark);
}
.btn-secondary:hover { background: var(--border); }
.btn-danger { background: var(--red-light); color: var(--red); }
.btn-danger:hover { background: var(--red); color: white; }
.btn-sm { padding: 7px 12px; font-size: 13px; }
.btn-icon { padding: 9px; border-radius: var(--radius-sm); background: var(--green-pale); color: var(--green-dark); cursor: pointer; border: none; font-size: 18px; }
.btn-icon:hover { background: var(--border); }
.login-demo { margin-top: 20px; }
.login-demo p { text-align: center; font-size: 12px; color: var(--text-muted); margin-bottom: 10px; }
.demo-btns { display: flex; gap: 8px; flex-wrap: wrap; }
.demo-btns button { flex: 1; min-width: 80px; padding: 8px; font-size: 12px; border: 1.5px solid var(--border); background: var(--bg); color: var(--text-muted); border-radius: 6px; cursor: pointer; font-family: 'DM Sans', sans-serif; }
.demo-btns button:hover { border-color: var(--green-accent); color: var(--green-accent); }
.error-msg { background: var(--red-light); color: var(--red); padding: 10px 14px; border-radius: var(--radius-sm); font-size: 13px; margin-bottom: 16px; display: none; }

/* ‚îÄ‚îÄ APP LAYOUT ‚îÄ‚îÄ */
#screen-app {
  flex-direction: column;
}
.topbar {
  background: var(--green-dark);
  color: white;
  padding: 0 16px;
  height: 56px;
  display: flex;
  align-items: center;
  gap: 12px;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}
.topbar-logo { font-family: 'Syne', sans-serif; font-size: 16px; font-weight: 800; letter-spacing: -0.3px; flex: 1; }
.topbar-logo span { color: var(--green-light); }
.topbar-user { font-size: 13px; color: rgba(255,255,255,0.7); }
.topbar-avatar {
  width: 34px; height: 34px;
  background: var(--green-accent);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-weight: 700; font-size: 14px;
  cursor: pointer;
}
.main-content { flex: 1; overflow-y: auto; padding-bottom: 80px; }

/* ‚îÄ‚îÄ BOTTOM NAV ‚îÄ‚îÄ */
.bottom-nav {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  background: var(--white);
  border-top: 1.5px solid var(--border);
  display: flex;
  z-index: 100;
  box-shadow: 0 -4px 20px rgba(11,61,46,0.08);
}
.nav-item {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 8px 4px 10px;
  gap: 3px;
  cursor: pointer;
  border: none;
  background: transparent;
  color: var(--text-muted);
  font-family: 'DM Sans', sans-serif;
  font-size: 10px;
  font-weight: 500;
  transition: color 0.2s;
  position: relative;
}
.nav-item .nav-icon { font-size: 22px; }
.nav-item.active { color: var(--green-dark); }
.nav-item.active .nav-icon { font-size: 22px; }
.nav-badge {
  position: absolute;
  top: 6px;
  right: calc(50% - 16px);
  background: var(--red);
  color: white;
  font-size: 10px;
  font-weight: 700;
  min-width: 16px; height: 16px;
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  padding: 0 4px;
}

/* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
.page { display: none; padding: 16px; }
.page.active { display: block; }
.page-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 20px;
}
.page-header h2 { font-size: 20px; color: var(--green-dark); flex: 1; }
.section-label {
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-bottom: 12px;
  padding-left: 2px;
}

/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 20px;
}
.stat-card {
  background: var(--white);
  border-radius: var(--radius);
  padding: 16px;
  box-shadow: var(--shadow);
  position: relative;
  overflow: hidden;
}
.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
}
.stat-card.green::before { background: var(--green-accent); }
.stat-card.red::before { background: var(--red); }
.stat-card.orange::before { background: var(--orange); }
.stat-card.blue::before { background: var(--blue); }
.stat-value { font-family: 'Syne', sans-serif; font-size: 30px; font-weight: 800; color: var(--green-dark); line-height: 1; }
.stat-card.red .stat-value { color: var(--red); }
.stat-card.orange .stat-value { color: var(--orange); }
.stat-card.blue .stat-value { color: var(--blue); }
.stat-label { font-size: 12px; color: var(--text-muted); margin-top: 4px; font-weight: 500; }
.stat-icon { font-size: 24px; margin-bottom: 8px; }

.chart-card {
  background: var(--white);
  border-radius: var(--radius);
  padding: 16px;
  box-shadow: var(--shadow);
  margin-bottom: 12px;
}
.chart-card h4 { font-size: 14px; color: var(--green-dark); margin-bottom: 14px; }
.bar-chart { display: flex; flex-direction: column; gap: 10px; }
.bar-row { display: flex; align-items: center; gap: 8px; }
.bar-label { font-size: 12px; color: var(--text-muted); width: 90px; flex-shrink: 0; }
.bar-track { flex: 1; height: 10px; background: var(--green-pale); border-radius: 5px; overflow: hidden; }
.bar-fill { height: 100%; background: var(--green-accent); border-radius: 5px; transition: width 0.8s ease; }
.bar-val { font-size: 12px; font-weight: 600; color: var(--green-dark); width: 24px; text-align: right; }

/* ‚îÄ‚îÄ TICKETS ‚îÄ‚îÄ */
.ticket-filters {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  padding-bottom: 4px;
  margin-bottom: 14px;
  scrollbar-width: none;
}
.ticket-filters::-webkit-scrollbar { display: none; }
.filter-chip {
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  border: 1.5px solid var(--border);
  background: var(--white);
  color: var(--text-muted);
  white-space: nowrap;
  transition: all 0.2s;
}
.filter-chip.active {
  background: var(--green-dark);
  border-color: var(--green-dark);
  color: white;
}
.ticket-list { display: flex; flex-direction: column; gap: 10px; }
.ticket-card {
  background: var(--white);
  border-radius: var(--radius);
  padding: 14px 16px;
  box-shadow: var(--shadow);
  border-left: 4px solid var(--green-accent);
  cursor: pointer;
  transition: box-shadow 0.2s, transform 0.1s;
  position: relative;
}
.ticket-card:active { transform: scale(0.99); }
.ticket-card:hover { box-shadow: var(--shadow-lg); }
.ticket-card.priority-critica { border-left-color: var(--red); }
.ticket-card.priority-alta { border-left-color: var(--orange); }
.ticket-card.priority-media { border-left-color: var(--yellow); }
.ticket-card.priority-baixa { border-left-color: var(--blue); }
.ticket-card.sla-vencido { background: #fff9f9; }
.ticket-top {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 6px;
}
.ticket-proto { font-size: 11px; color: var(--text-muted); font-weight: 600; }
.ticket-title { font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 6px; line-height: 1.3; }
.ticket-meta { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
.badge {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 3px 8px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
}
.badge-status-OPEN { background: var(--blue-light); color: var(--blue); }
.badge-status-IN_PROGRESS { background: var(--orange-light); color: var(--orange); }
.badge-status-WAITING { background: var(--yellow-light); color: #8B6914; }
.badge-status-DONE { background: var(--green-pale); color: var(--green-dark); }
.badge-status-CANCELED { background: #f0f0f0; color: #888; }
.badge-priority-critica { background: var(--red-light); color: var(--red); }
.badge-priority-alta { background: var(--orange-light); color: var(--orange); }
.badge-priority-media { background: var(--yellow-light); color: #8B6914; }
.badge-priority-baixa { background: var(--blue-light); color: var(--blue); }
.badge-sla { background: var(--red-light); color: var(--red); }
.badge-setor { background: var(--green-pale); color: var(--green-dark); }
.ticket-sla-bar {
  margin-top: 10px;
  height: 4px;
  background: var(--border);
  border-radius: 2px;
  overflow: hidden;
}
.ticket-sla-fill {
  height: 100%;
  border-radius: 2px;
  transition: width 0.5s;
}

/* ‚îÄ‚îÄ TICKET DETAIL ‚îÄ‚îÄ */
.detail-screen { display: none; }
.detail-screen.active { display: flex; flex-direction: column; flex: 1; }
.detail-header {
  background: var(--green-dark);
  color: white;
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
}
.detail-header h3 { flex: 1; font-size: 16px; }
.detail-body { flex: 1; overflow-y: auto; padding: 16px; padding-bottom: 100px; }
.detail-section { background: var(--white); border-radius: var(--radius); padding: 16px; margin-bottom: 12px; box-shadow: var(--shadow); }
.detail-section h4 { font-size: 13px; font-weight: 700; color: var(--green-dark); margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.5px; }
.detail-row { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border); }
.detail-row:last-child { border-bottom: none; padding-bottom: 0; }
.detail-row .dr-label { font-size: 13px; color: var(--text-muted); }
.detail-row .dr-value { font-size: 14px; font-weight: 600; color: var(--text); text-align: right; }

/* CHAT */
.chat-container { display: flex; flex-direction: column; height: 100%; }
.chat-messages { flex: 1; overflow-y: auto; padding: 12px; display: flex; flex-direction: column; gap: 10px; min-height: 200px; max-height: 40vh; }
.chat-msg { max-width: 80%; }
.chat-msg.mine { align-self: flex-end; }
.chat-msg.other { align-self: flex-start; }
.chat-bubble {
  padding: 10px 14px;
  border-radius: 14px;
  font-size: 14px;
  line-height: 1.4;
}
.chat-msg.mine .chat-bubble { background: var(--green-dark); color: white; border-bottom-right-radius: 4px; }
.chat-msg.other .chat-bubble { background: var(--bg); color: var(--text); border-bottom-left-radius: 4px; border: 1px solid var(--border); }
.chat-meta { font-size: 10px; color: var(--text-muted); margin-top: 3px; padding: 0 4px; }
.chat-msg.mine .chat-meta { text-align: right; }
.chat-input-area {
  display: flex;
  gap: 8px;
  align-items: flex-end;
  padding: 12px;
  background: var(--white);
  border-top: 1.5px solid var(--border);
  position: sticky;
  bottom: 0;
}
.chat-input-area textarea {
  flex: 1;
  padding: 10px 12px;
  border: 1.5px solid var(--border);
  border-radius: 20px;
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  resize: none;
  max-height: 100px;
  outline: none;
  background: var(--bg);
}
.chat-input-area textarea:focus { border-color: var(--green-accent); background: white; }
.chat-send-btn {
  width: 42px; height: 42px;
  background: var(--green-dark);
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 18px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  flex-shrink: 0;
}
.chat-send-btn:hover { background: var(--green-mid); }

/* ACTION BAR */
.action-bar {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  background: var(--white);
  border-top: 1.5px solid var(--border);
  padding: 12px 16px;
  display: flex;
  gap: 10px;
  z-index: 200;
}
.action-bar .btn { flex: 1; }

/* ‚îÄ‚îÄ NEW TICKET MODAL ‚îÄ‚îÄ */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 300;
  align-items: flex-end;
}
.modal-overlay.active { display: flex; }
.modal-sheet {
  background: var(--white);
  border-radius: 20px 20px 0 0;
  padding: 20px 20px 40px;
  width: 100%;
  max-height: 92vh;
  overflow-y: auto;
  animation: slideUp 0.3s ease;
}
@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}
.modal-handle { width: 40px; height: 4px; background: var(--border); border-radius: 2px; margin: 0 auto 20px; }
.modal-title { font-family: 'Syne', sans-serif; font-size: 18px; color: var(--green-dark); margin-bottom: 20px; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

/* ‚îÄ‚îÄ SECTOR CHAT ‚îÄ‚îÄ */
.sector-tabs {
  display: flex;
  overflow-x: auto;
  gap: 8px;
  padding-bottom: 4px;
  margin-bottom: 14px;
  scrollbar-width: none;
}
.sector-tabs::-webkit-scrollbar { display: none; }
.sector-tab {
  padding: 7px 14px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  border: 1.5px solid var(--border);
  background: var(--white);
  color: var(--text-muted);
  white-space: nowrap;
  transition: all 0.2s;
}
.sector-tab.active { background: var(--green-dark); border-color: var(--green-dark); color: white; }

/* ‚îÄ‚îÄ EQUIPMENT ‚îÄ‚îÄ */
.equip-card {
  background: var(--white);
  border-radius: var(--radius);
  padding: 14px 16px;
  box-shadow: var(--shadow);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 14px;
  cursor: pointer;
}
.equip-icon {
  width: 46px; height: 46px;
  background: var(--green-pale);
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 22px;
  flex-shrink: 0;
}
.equip-info { flex: 1; }
.equip-name { font-weight: 600; font-size: 15px; color: var(--text); }
.equip-code { font-size: 12px; color: var(--text-muted); }
.equip-status { font-size: 11px; font-weight: 700; padding: 3px 8px; border-radius: 10px; }
.equip-status.ativo { background: var(--green-pale); color: var(--green-dark); }
.equip-status.manutencao { background: var(--orange-light); color: var(--orange); }
.equip-status.inativo { background: #f0f0f0; color: #888; }

/* ‚îÄ‚îÄ FAB ‚îÄ‚îÄ */
.fab {
  position: fixed;
  bottom: 80px;
  right: 16px;
  width: 52px; height: 52px;
  background: var(--green-dark);
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 26px;
  cursor: pointer;
  box-shadow: 0 4px 20px rgba(11,61,46,0.4);
  display: flex; align-items: center; justify-content: center;
  z-index: 99;
  transition: transform 0.2s, background 0.2s;
}
.fab:hover { background: var(--green-mid); transform: scale(1.05); }
.fab:active { transform: scale(0.97); }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed;
  bottom: 90px;
  left: 50%;
  transform: translateX(-50%) translateY(20px);
  background: var(--green-dark);
  color: white;
  padding: 12px 20px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 500;
  z-index: 999;
  opacity: 0;
  transition: all 0.3s;
  white-space: nowrap;
  box-shadow: 0 4px 20px rgba(0,0,0,0.2);
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ‚îÄ‚îÄ HISTORY LOG ‚îÄ‚îÄ */
.log-item {
  display: flex;
  gap: 12px;
  padding: 10px 0;
  border-bottom: 1px solid var(--border);
}
.log-item:last-child { border-bottom: none; }
.log-dot {
  width: 10px; height: 10px;
  background: var(--green-accent);
  border-radius: 50%;
  margin-top: 5px;
  flex-shrink: 0;
}
.log-content { flex: 1; }
.log-action { font-size: 13px; font-weight: 600; color: var(--text); }
.log-detail { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
.log-time { font-size: 11px; color: var(--text-muted); }

/* ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ */
.profile-card {
  background: var(--green-dark);
  border-radius: var(--radius);
  padding: 24px 20px;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 16px;
  color: white;
}
.profile-avatar {
  width: 56px; height: 56px;
  background: var(--green-accent);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Syne', sans-serif;
  font-size: 22px;
  font-weight: 700;
}
.profile-name { font-size: 18px; font-weight: 700; }
.profile-role { font-size: 13px; opacity: 0.7; margin-top: 2px; }
.profile-setor { font-size: 12px; background: rgba(255,255,255,0.15); padding: 3px 10px; border-radius: 10px; display: inline-block; margin-top: 6px; }
.menu-item {
  display: flex;
  align-items: center;
  gap: 14px;
  background: var(--white);
  border-radius: var(--radius-sm);
  padding: 14px 16px;
  margin-bottom: 8px;
  cursor: pointer;
  box-shadow: var(--shadow);
  transition: background 0.2s;
  border: none;
  width: 100%;
  text-align: left;
  font-family: 'DM Sans', sans-serif;
}
.menu-item:hover { background: var(--green-pale); }
.menu-item .mi-icon { font-size: 20px; }
.menu-item .mi-label { flex: 1; font-size: 15px; font-weight: 500; color: var(--text); }
.menu-item .mi-arrow { color: var(--text-muted); }

/* SCROLLBAR */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* Empty state */
.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: var(--text-muted);
}
.empty-state .empty-icon { font-size: 48px; margin-bottom: 12px; }
.empty-state p { font-size: 15px; }

/* Responsive */
@media (min-width: 600px) {
  .stats-grid { grid-template-columns: repeat(4, 1fr); }
  .main-content { max-width: 680px; margin: 0 auto; }
  .bottom-nav { max-width: 680px; left: 50%; transform: translateX(-50%); }
  .fab { right: calc(50% - 340px + 16px); }
}
</style>
</head>
<body>

<!-- ‚îÄ‚îÄ LOGIN SCREEN ‚îÄ‚îÄ -->
<div id="screen-login" class="screen active">
  <div class="login-card">
    <div class="login-logo">
      <div class="logo-icon">üåø</div>
      <h1>FRUTESP</h1>
      <p>Gest√£o Operacional</p>
    </div>
    <div id="login-error" class="error-msg">Email ou senha incorretos.</div>
    <div class="form-group">
      <label>Email</label>
      <input type="email" id="inp-email" placeholder="seu@email.com" value="gestor@frutesp.com">
    </div>
    <div class="form-group">
      <label>Senha</label>
      <input type="password" id="inp-senha" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="123456">
    </div>
    <button class="btn btn-primary" onclick="doLogin()">Entrar</button>
    <div class="login-demo">
      <p>üîë Acesso r√°pido demo:</p>
      <div class="demo-btns">
        <button onclick="quickLogin('gestor@frutesp.com','Gestor')">üëë Gestor</button>
        <button onclick="quickLogin('mecanica@frutesp.com','Atendente')">üîß Atendente</button>
        <button onclick="quickLogin('joao@frutesp.com','Solicitante')">üë§ Solicitante</button>
      </div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ APP SCREEN ‚îÄ‚îÄ -->
<div id="screen-app" class="screen">
  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbar-logo">FRUTE<span>SP</span></div>
    <div class="topbar-user" id="topbar-user-name"></div>
    <div class="topbar-avatar" id="topbar-avatar" onclick="navTo('perfil')"></div>
  </div>

  <!-- MAIN -->
  <div class="main-content" id="main-content">

    <!-- DASHBOARD PAGE -->
    <div id="page-dashboard" class="page active">
      <div class="page-header">
        <h2 id="dash-title">Dashboard</h2>
      </div>
      <div class="stats-grid" id="stats-grid"></div>
      <div class="section-label">Tickets por Setor</div>
      <div class="chart-card">
        <div class="bar-chart" id="bar-setor"></div>
      </div>
      <div class="section-label">Equipamentos com mais ocorr√™ncias</div>
      <div class="chart-card">
        <div class="bar-chart" id="bar-equip"></div>
      </div>
    </div>

    <!-- TICKETS PAGE -->
    <div id="page-tickets" class="page">
      <div class="page-header">
        <h2>Chamados</h2>
        <div id="tickets-count" class="badge badge-status-OPEN"></div>
      </div>
      <div class="ticket-filters" id="ticket-filters">
        <div class="filter-chip active" onclick="filterTickets('todos',this)">Todos</div>
        <div class="filter-chip" onclick="filterTickets('OPEN',this)">Abertos</div>
        <div class="filter-chip" onclick="filterTickets('IN_PROGRESS',this)">Em andamento</div>
        <div class="filter-chip" onclick="filterTickets('WAITING',this)">Aguardando</div>
        <div class="filter-chip" onclick="filterTickets('DONE',this)">Conclu√≠dos</div>
        <div class="filter-chip" onclick="filterTickets('sla',this)">‚ö†Ô∏è SLA Vencido</div>
      </div>
      <div class="ticket-list" id="ticket-list"></div>
    </div>

    <!-- CHAT PAGE -->
    <div id="page-chat" class="page">
      <div class="page-header">
        <h2>Chat por Setor</h2>
      </div>
      <div class="sector-tabs" id="sector-tabs"></div>
      <div id="sector-chat-area">
        <div class="chat-messages" id="sector-chat-msgs" style="max-height:55vh;"></div>
        <div class="chat-input-area">
          <textarea id="sector-chat-input" placeholder="Digite uma mensagem..." rows="1"></textarea>
          <button class="chat-send-btn" onclick="sendSectorMsg()">‚û§</button>
        </div>
      </div>
    </div>

    <!-- EQUIPAMENTOS PAGE -->
    <div id="page-equip" class="page">
      <div class="page-header">
        <h2>Equipamentos</h2>
        <button id="btn-add-equip" class="btn btn-secondary btn-sm">+ Novo</button>
      </div>
      <div id="equip-list"></div>
    </div>

    <!-- PERFIL PAGE -->
    <div id="page-perfil" class="page">
      <div class="profile-card">
        <div class="profile-avatar" id="perfil-avatar"></div>
        <div>
          <div class="profile-name" id="perfil-name"></div>
          <div class="profile-role" id="perfil-role"></div>
          <div class="profile-setor" id="perfil-setor"></div>
        </div>
      </div>
      <div class="section-label">Configura√ß√µes</div>
      <button class="menu-item" onclick="showAdminPanel()">
        <span class="mi-icon">‚öôÔ∏è</span>
        <span class="mi-label">Painel Administrativo</span>
        <span class="mi-arrow">‚Ä∫</span>
      </button>
      <button class="menu-item">
        <span class="mi-icon">üîî</span>
        <span class="mi-label">Notifica√ß√µes</span>
        <span class="mi-arrow">‚Ä∫</span>
      </button>
      <button class="menu-item">
        <span class="mi-icon">üìä</span>
        <span class="mi-label">Relat√≥rios</span>
        <span class="mi-arrow">‚Ä∫</span>
      </button>
      <button class="menu-item" onclick="doLogout()">
        <span class="mi-icon">üö™</span>
        <span class="mi-label">Sair</span>
        <span class="mi-arrow">‚Ä∫</span>
      </button>
    </div>

  </div><!-- /main-content -->

  <!-- BOTTOM NAV -->
  <nav class="bottom-nav" id="bottom-nav">
    <button class="nav-item active" onclick="navTo('dashboard')">
      <span class="nav-icon">üìä</span>Dashboard
    </button>
    <button class="nav-item" onclick="navTo('tickets')" id="nav-tickets">
      <span class="nav-icon">üìã</span>Chamados
      <span class="nav-badge" id="nav-badge" style="display:none"></span>
    </button>
    <button class="nav-item" onclick="navTo('chat')">
      <span class="nav-icon">üí¨</span>Chat
    </button>
    <button class="nav-item" onclick="navTo('equip')">
      <span class="nav-icon">üîß</span>Equip.
    </button>
    <button class="nav-item" onclick="navTo('perfil')">
      <span class="nav-icon">üë§</span>Perfil
    </button>
  </nav>

  <!-- FAB -->
  <button class="fab" id="fab-btn" onclick="openNewTicketModal()">+</button>

</div>

<!-- ‚îÄ‚îÄ TICKET DETAIL (inside app) ‚îÄ‚îÄ -->
<div id="ticket-detail-overlay" style="display:none; position:fixed; inset:0; background:var(--bg); z-index:250; overflow-y:auto; display:none; flex-direction:column;">
  <div class="detail-header">
    <button class="btn-icon" style="background:rgba(255,255,255,0.15); color:white; font-size:20px;" onclick="closeDetail()">‚Üê</button>
    <h3 id="detail-proto">Chamado</h3>
    <div id="detail-status-badge"></div>
  </div>
  <div class="detail-body">
    <div class="detail-section">
      <h4>Informa√ß√µes</h4>
      <div class="detail-row"><span class="dr-label">T√≠tulo</span><span class="dr-value" id="d-titulo"></span></div>
      <div class="detail-row"><span class="dr-label">Categoria</span><span class="dr-value" id="d-categoria"></span></div>
      <div class="detail-row"><span class="dr-label">Prioridade</span><span class="dr-value" id="d-prioridade"></span></div>
      <div class="detail-row"><span class="dr-label">Setor</span><span class="dr-value" id="d-setor"></span></div>
      <div class="detail-row"><span class="dr-label">Local</span><span class="dr-value" id="d-local"></span></div>
      <div class="detail-row"><span class="dr-label">Equipamento</span><span class="dr-value" id="d-equip"></span></div>
      <div class="detail-row"><span class="dr-label">Impacto</span><span class="dr-value" id="d-impacto"></span></div>
      <div class="detail-row"><span class="dr-label">Parada (min)</span><span class="dr-value" id="d-parada"></span></div>
    </div>
    <div class="detail-section">
      <h4>Descri√ß√£o</h4>
      <p style="font-size:14px; color:var(--text); line-height:1.6;" id="d-descricao"></p>
    </div>
    <div class="detail-section">
      <h4>Datas & SLA</h4>
      <div class="detail-row"><span class="dr-label">Abertura</span><span class="dr-value" id="d-abertura"></span></div>
      <div class="detail-row"><span class="dr-label">Prazo SLA</span><span class="dr-value" id="d-sla"></span></div>
      <div class="detail-row"><span class="dr-label">Respons√°vel</span><span class="dr-value" id="d-responsavel"></span></div>
      <div class="detail-row"><span class="dr-label">Solicitante</span><span class="dr-value" id="d-solicitante"></span></div>
    </div>
    <!-- CHAT DO TICKET -->
    <div class="detail-section" style="padding-bottom:0;">
      <h4>Mensagens</h4>
      <div class="chat-messages" id="ticket-chat-msgs" style="min-height:100px;"></div>
    </div>
    <div class="chat-input-area" style="border-radius:0 0 var(--radius) var(--radius); background:var(--bg);">
      <textarea id="ticket-chat-input" placeholder="Responder..." rows="1"></textarea>
      <button class="chat-send-btn" onclick="sendTicketMsg()">‚û§</button>
    </div>
    <!-- HIST√ìRICO -->
    <div class="detail-section" style="margin-top:12px;">
      <h4>Hist√≥rico de Altera√ß√µes</h4>
      <div id="ticket-history"></div>
    </div>
  </div>
  <!-- ACTION BAR -->
  <div class="action-bar" id="detail-actions"></div>
</div>

<!-- ‚îÄ‚îÄ NEW TICKET MODAL ‚îÄ‚îÄ -->
<div class="modal-overlay" id="modal-new-ticket">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">üé´ Novo Chamado</div>
    <div class="form-group">
      <label>T√≠tulo</label>
      <input type="text" id="nt-titulo" placeholder="Descreva brevemente o problema">
    </div>
    <div class="form-group">
      <label>Descri√ß√£o detalhada</label>
      <textarea id="nt-descricao" placeholder="Explique o problema em detalhes..."></textarea>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Categoria</label>
        <select id="nt-categoria">
          <option value="Corretiva">Corretiva</option>
          <option value="Preventiva">Preventiva</option>
          <option value="Emergencial">Emergencial</option>
          <option value="Administrativa">Administrativa</option>
        </select>
      </div>
      <div class="form-group">
        <label>Prioridade</label>
        <select id="nt-prioridade">
          <option value="baixa">Baixa</option>
          <option value="media">M√©dia</option>
          <option value="alta">Alta</option>
          <option value="critica">Cr√≠tica</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Setor</label>
        <select id="nt-setor">
          <option>Produ√ß√£o</option>
          <option>Mec√¢nica</option>
          <option>Irriga√ß√£o</option>
          <option>Packing House</option>
          <option>Administrativo</option>
        </select>
      </div>
      <div class="form-group">
        <label>Local</label>
        <select id="nt-local">
          <option>Talh√£o A</option>
          <option>Talh√£o B</option>
          <option>Packing</option>
          <option>C√¢mara Fria</option>
          <option>Oficina</option>
          <option>Escrit√≥rio</option>
        </select>
      </div>
    </div>
    <div class="form-group">
      <label>Equipamento (opcional)</label>
      <select id="nt-equip">
        <option value="">-- Nenhum --</option>
        <option>TR-001 ‚Äì Trator John Deere</option>
        <option>PL-003 ‚Äì Pulverizador Jacto</option>
        <option>BM-007 ‚Äì Bomba Irriga√ß√£o #1</option>
        <option>CF-002 ‚Äì C√¢mara Fria 1</option>
      </select>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Impacto Operacional</label>
        <select id="nt-impacto">
          <option>Baixo</option>
          <option>M√©dio</option>
          <option>Alto</option>
        </select>
      </div>
      <div class="form-group">
        <label>Tempo de parada (min)</label>
        <input type="number" id="nt-parada" value="0" min="0">
      </div>
    </div>
    <div style="display:flex; gap:10px; margin-top:8px;">
      <button class="btn btn-secondary" style="flex:1" onclick="closeNewTicketModal()">Cancelar</button>
      <button class="btn btn-primary" style="flex:2" onclick="submitNewTicket()">Abrir Chamado</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const USERS = [
  { id:1, email:'gestor@frutesp.com', senha:'123456', nome:'Carlos Gestor', perfil:'Gestor', setor:'Gest√£o', avatar:'CG' },
  { id:2, email:'mecanica@frutesp.com', senha:'123456', nome:'Ana Mec√¢nica', perfil:'Atendente', setor:'Mec√¢nica', avatar:'AM' },
  { id:3, email:'irrigacao@frutesp.com', senha:'123456', nome:'Bruno Irriga√ß√£o', perfil:'Atendente', setor:'Irriga√ß√£o', avatar:'BI' },
  { id:4, email:'joao@frutesp.com', senha:'123456', nome:'Jo√£o Silva', perfil:'Solicitante', setor:'Produ√ß√£o', avatar:'JS' },
  { id:5, email:'maria@frutesp.com', senha:'123456', nome:'Maria Oliveira', perfil:'Solicitante', setor:'Packing House', avatar:'MO' },
];

const SLA_HORAS = { baixa:72, media:48, alta:24, critica:6 };

let currentUser = null;
let tickets = [];
let sectorChats = {};
let equipamentos = [];
let currentTicketId = null;
let currentSector = null;
let ticketCounter = 1000;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SEED DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function seedData() {
  const now = Date.now();
  const h = 3600000;

  tickets = [
    makeTicket({ titulo:'Trator TR-001 n√£o liga', descricao:'O trator John Deere da √°rea A n√£o est√° dando partida desde ontem √†s 14h.', categoria:'Corretiva', prioridade:'critica', setor:'Mec√¢nica', local:'Talh√£o A', equip:'TR-001 ‚Äì Trator John Deere', impacto:'Alto', parada:120, criadoPor:4, criadoEm: now - 8*h, status:'IN_PROGRESS', responsavel:2 }),
    makeTicket({ titulo:'Vazamento na linha de irriga√ß√£o Bloco C', descricao:'Identificado vazamento significativo na linha principal do bloco C. Perda estimada de 30% da press√£o.', categoria:'Corretiva', prioridade:'alta', setor:'Irriga√ß√£o', local:'Talh√£o B', equip:'BM-007 ‚Äì Bomba Irriga√ß√£o #1', impacto:'M√©dio', parada:60, criadoPor:4, criadoEm: now - 3*h, status:'OPEN', responsavel:3 }),
    makeTicket({ titulo:'Revis√£o preventiva C√¢mara Fria', descricao:'Realizar revis√£o mensal no compressor e verificar veda√ß√µes da c√¢mara fria.', categoria:'Preventiva', prioridade:'media', setor:'Mec√¢nica', local:'C√¢mara Fria', equip:'CF-002 ‚Äì C√¢mara Fria 1', impacto:'Baixo', parada:0, criadoPor:5, criadoEm: now - 24*h, status:'WAITING', responsavel:2 }),
    makeTicket({ titulo:'Esteira packing house parada', descricao:'Esteira principal do packing house parou na madrugada, produ√ß√£o totalmente parada.', categoria:'Emergencial', prioridade:'critica', setor:'Packing House', local:'Packing', equip:'', impacto:'Alto', parada:240, criadoPor:5, criadoEm: now - 10*h, status:'DONE', responsavel:2 }),
    makeTicket({ titulo:'Solicita√ß√£o de material EPI', descricao:'Solicitar reposi√ß√£o de luvas, botas e capacetes para equipe da lavoura.', categoria:'Administrativa', prioridade:'baixa', setor:'Administrativo', local:'Escrit√≥rio', equip:'', impacto:'Baixo', parada:0, criadoPor:4, criadoEm: now - 48*h, status:'OPEN', responsavel:null }),
    makeTicket({ titulo:'Pulverizador com vazamento no bico 4', descricao:'Bico n√∫mero 4 do pulverizador Jacto est√° vazando durante a aplica√ß√£o.', categoria:'Corretiva', prioridade:'media', setor:'Mec√¢nica', local:'Talh√£o A', equip:'PL-003 ‚Äì Pulverizador Jacto', impacto:'M√©dio', parada:30, criadoPor:4, criadoEm: now - 5*h, status:'OPEN', responsavel:2 }),
  ];

  equipamentos = [
    { id:1, nome:'Trator John Deere', codigo:'TR-001', tipo:'Trator', setor:'Produ√ß√£o', local:'Talh√£o A', status:'manutencao', horimetro:2340, ultimaPreventiva:'2025-12-01', proximaPreventiva:'2026-03-01' },
    { id:2, nome:'C√¢mara Fria 1', codigo:'CF-002', tipo:'C√¢mara Fria', setor:'Packing House', local:'C√¢mara Fria', status:'ativo', horimetro:null, ultimaPreventiva:'2025-11-15', proximaPreventiva:'2026-02-15' },
    { id:3, nome:'Pulverizador Jacto', codigo:'PL-003', tipo:'Pulverizador', setor:'Produ√ß√£o', local:'Talh√£o B', status:'ativo', horimetro:890, ultimaPreventiva:'2025-10-01', proximaPreventiva:'2026-01-01' },
    { id:4, nome:'Bomba Irriga√ß√£o #1', codigo:'BM-007', tipo:'Bomba', setor:'Irriga√ß√£o', local:'Talh√£o B', status:'ativo', horimetro:1560, ultimaPreventiva:'2025-12-20', proximaPreventiva:'2026-03-20' },
  ];

  const setores = ['Produ√ß√£o','Mec√¢nica','Irriga√ß√£o','Packing House','Gest√£o'];
  setores.forEach(s => { sectorChats[s] = []; });
  sectorChats['Mec√¢nica'].push(
    { user: USERS[1], msg: 'Pessoal, trator TR-001 ser√° revisado hoje √†s 14h.', ts: Date.now()-3600000 },
    { user: USERS[0], msg: 'Ok, priorizem o chamado cr√≠tico! ‚ö†Ô∏è', ts: Date.now()-1800000 }
  );
  sectorChats['Irriga√ß√£o'].push(
    { user: USERS[2], msg: 'Vou verificar o bloco C agora.', ts: Date.now()-900000 }
  );
}

function makeTicket(d) {
  ticketCounter++;
  const slaH = SLA_HORAS[d.prioridade] || 48;
  const prazo = d.criadoEm + slaH * 3600000;
  return {
    id: ticketCounter,
    proto: `#FRU-${ticketCounter}`,
    titulo: d.titulo,
    descricao: d.descricao,
    categoria: d.categoria,
    prioridade: d.prioridade,
    setor: d.setor,
    local: d.local,
    equip: d.equip,
    impacto: d.impacto,
    parada: d.parada,
    criadoPor: d.criadoPor,
    criadoEm: d.criadoEm,
    responsavel: d.responsavel,
    status: d.status,
    slaDeadline: prazo,
    chat: [],
    history: [{ acao:'Chamado aberto', usuario: d.criadoPor, ts: d.criadoEm, de:null, para: d.status }]
  };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// AUTH
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function quickLogin(email, perfil) {
  document.getElementById('inp-email').value = email;
  document.getElementById('inp-senha').value = '123456';
  doLogin();
}

function doLogin() {
  const email = document.getElementById('inp-email').value.trim();
  const senha = document.getElementById('inp-senha').value;
  const user = USERS.find(u => u.email === email && u.senha === senha);
  if (!user) {
    document.getElementById('login-error').style.display = 'block';
    return;
  }
  currentUser = user;
  document.getElementById('login-error').style.display = 'none';
  document.getElementById('screen-login').classList.remove('active');
  document.getElementById('screen-app').classList.add('active');
  initApp();
}

function doLogout() {
  currentUser = null;
  document.getElementById('screen-app').classList.remove('active');
  document.getElementById('screen-login').classList.add('active');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// INIT APP
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initApp() {
  // Topbar
  document.getElementById('topbar-user-name').textContent = currentUser.nome.split(' ')[0];
  document.getElementById('topbar-avatar').textContent = currentUser.avatar;
  // Perfil
  document.getElementById('perfil-avatar').textContent = currentUser.avatar;
  document.getElementById('perfil-name').textContent = currentUser.nome;
  document.getElementById('perfil-role').textContent = currentUser.perfil;
  document.getElementById('perfil-setor').textContent = currentUser.setor;
  // Gestor-only
  const isGestor = currentUser.perfil === 'Gestor';
  document.getElementById('btn-add-equip').style.display = isGestor ? '' : 'none';
  // Nav
  renderDashboard();
  renderTickets('todos');
  renderEquip();
  initChat();
  updateBadge();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function navTo(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  const navItems = document.querySelectorAll('.nav-item');
  const pages = ['dashboard','tickets','chat','equip','perfil'];
  const idx = pages.indexOf(page);
  if (idx >= 0) navItems[idx].classList.add('active');
  // FAB only on tickets page for solicitante/gestor, or always
  document.getElementById('fab-btn').style.display = (page === 'tickets' || page === 'dashboard') ? 'flex' : 'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DASHBOARD
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderDashboard() {
  const myTickets = getVisibleTickets();
  const open = myTickets.filter(t => t.status !== 'DONE' && t.status !== 'CANCELED');
  const criticos = myTickets.filter(t => t.prioridade === 'critica' && t.status !== 'DONE' && t.status !== 'CANCELED');
  const slaVencidos = myTickets.filter(t => isSLAVencido(t) && t.status !== 'DONE');
  const done = myTickets.filter(t => t.status === 'DONE');
  const totalMin = myTickets.reduce((s,t) => s + (t.parada||0), 0);
  const slaOk = myTickets.filter(t => t.status === 'DONE' && !isSLAVencido(t)).length;
  const slaPct = done.length ? Math.round(slaOk/done.length*100) : 100;

  document.getElementById('dash-title').textContent = currentUser.perfil === 'Gestor' ? 'Dashboard Geral' : `Dashboard ‚Äì ${currentUser.setor}`;

  document.getElementById('stats-grid').innerHTML = `
    <div class="stat-card green"><div class="stat-icon">üìã</div><div class="stat-value">${open.length}</div><div class="stat-label">Abertos</div></div>
    <div class="stat-card red"><div class="stat-icon">üö®</div><div class="stat-value">${criticos.length}</div><div class="stat-label">Cr√≠ticos</div></div>
    <div class="stat-card orange"><div class="stat-icon">‚ö†Ô∏è</div><div class="stat-value">${slaVencidos.length}</div><div class="stat-label">SLA Vencido</div></div>
    <div class="stat-card blue"><div class="stat-icon">‚úÖ</div><div class="stat-value">${slaPct}%</div><div class="stat-label">SLA Cumprido</div></div>
  `;

  // Bar setor
  const setores = ['Produ√ß√£o','Mec√¢nica','Irriga√ß√£o','Packing House','Administrativo'];
  const max = Math.max(...setores.map(s => myTickets.filter(t => t.setor === s).length), 1);
  document.getElementById('bar-setor').innerHTML = setores.map(s => {
    const cnt = myTickets.filter(t => t.setor === s).length;
    return `<div class="bar-row"><div class="bar-label">${s.replace(' House','')}</div><div class="bar-track"><div class="bar-fill" style="width:${cnt/max*100}%"></div></div><div class="bar-val">${cnt}</div></div>`;
  }).join('');

  // Bar equip
  const equipMap = {};
  myTickets.forEach(t => { if(t.equip) { equipMap[t.equip] = (equipMap[t.equip]||0)+1; } });
  const equipArr = Object.entries(equipMap).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const maxE = equipArr.length ? equipArr[0][1] : 1;
  document.getElementById('bar-equip').innerHTML = equipArr.length ? equipArr.map(([k,v]) => {
    const label = k.split('‚Äì')[0].trim();
    return `<div class="bar-row"><div class="bar-label">${label}</div><div class="bar-track"><div class="bar-fill" style="width:${v/maxE*100}%; background:var(--orange)"></div></div><div class="bar-val">${v}</div></div>`;
  }).join('') : '<p style="color:var(--text-muted); font-size:13px;">Sem ocorr√™ncias registradas.</p>';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TICKETS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getVisibleTickets() {
  if (currentUser.perfil === 'Gestor') return tickets;
  if (currentUser.perfil === 'Atendente') return tickets.filter(t => t.setor === currentUser.setor);
  return tickets.filter(t => t.criadoPor === currentUser.id);
}

function isSLAVencido(t) {
  return Date.now() > t.slaDeadline && t.status !== 'DONE' && t.status !== 'CANCELED';
}

let currentFilter = 'todos';
function filterTickets(f, el) {
  currentFilter = f;
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  renderTickets(f);
}

function renderTickets(filter) {
  let list = getVisibleTickets();
  if (filter === 'sla') list = list.filter(t => isSLAVencido(t));
  else if (filter !== 'todos') list = list.filter(t => t.status === filter);
  list = list.sort((a,b) => {
    const pri = {critica:0,alta:1,media:2,baixa:3};
    return (pri[a.prioridade]||2) - (pri[b.prioridade]||2) || b.criadoEm - a.criadoEm;
  });

  document.getElementById('tickets-count').textContent = list.length;
  if (!list.length) {
    document.getElementById('ticket-list').innerHTML = `<div class="empty-state"><div class="empty-icon">üì≠</div><p>Nenhum chamado encontrado.</p></div>`;
    return;
  }
  document.getElementById('ticket-list').innerHTML = list.map(t => {
    const vencido = isSLAVencido(t);
    const slaTotal = t.slaDeadline - t.criadoEm;
    const slaPassed = Date.now() - t.criadoEm;
    const slaPct = Math.min(100, Math.round(slaPassed/slaTotal*100));
    const fillColor = vencido ? 'var(--red)' : slaPct > 70 ? 'var(--orange)' : 'var(--green-accent)';
    const user = USERS.find(u => u.id === t.criadoPor);
    return `
    <div class="ticket-card priority-${t.prioridade} ${vencido?'sla-vencido':''}" onclick="openDetail(${t.id})">
      <div class="ticket-top">
        <span class="ticket-proto">${t.proto}</span>
        ${vencido ? '<span class="badge badge-sla">‚ö†Ô∏è SLA</span>' : ''}
      </div>
      <div class="ticket-title">${t.titulo}</div>
      <div class="ticket-meta">
        <span class="badge badge-status-${t.status}">${statusLabel(t.status)}</span>
        <span class="badge badge-priority-${t.prioridade}">${t.prioridade.charAt(0).toUpperCase()+t.prioridade.slice(1)}</span>
        <span class="badge badge-setor">${t.setor}</span>
      </div>
      <div class="ticket-sla-bar"><div class="ticket-sla-fill" style="width:${slaPct}%; background:${fillColor}"></div></div>
    </div>`;
  }).join('');
}

function statusLabel(s) {
  const map = { OPEN:'Aberto', IN_PROGRESS:'Em Andamento', WAITING:'Aguardando', DONE:'Conclu√≠do', CANCELED:'Cancelado' };
  return map[s] || s;
}

function updateBadge() {
  const cnt = getVisibleTickets().filter(t => t.status === 'OPEN').length;
  const badge = document.getElementById('nav-badge');
  badge.textContent = cnt;
  badge.style.display = cnt > 0 ? 'flex' : 'none';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TICKET DETAIL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openDetail(id) {
  const t = tickets.find(x => x.id === id);
  if (!t) return;
  currentTicketId = id;

  document.getElementById('detail-proto').textContent = t.proto;
  document.getElementById('detail-status-badge').innerHTML = `<span class="badge badge-status-${t.status}">${statusLabel(t.status)}</span>`;
  document.getElementById('d-titulo').textContent = t.titulo;
  document.getElementById('d-categoria').textContent = t.categoria;
  document.getElementById('d-prioridade').innerHTML = `<span class="badge badge-priority-${t.prioridade}">${t.prioridade}</span>`;
  document.getElementById('d-setor').textContent = t.setor;
  document.getElementById('d-local').textContent = t.local;
  document.getElementById('d-equip').textContent = t.equip || '‚Äì';
  document.getElementById('d-impacto').textContent = t.impacto;
  document.getElementById('d-parada').textContent = t.parada;
  document.getElementById('d-descricao').textContent = t.descricao;
  document.getElementById('d-abertura').textContent = formatDate(t.criadoEm);
  document.getElementById('d-sla').innerHTML = `${formatDate(t.slaDeadline)} ${isSLAVencido(t)?'<span class="badge badge-sla">Vencido</span>':''}`;
  const resp = USERS.find(u => u.id === t.responsavel);
  document.getElementById('d-responsavel').textContent = resp ? resp.nome : 'N√£o atribu√≠do';
  const sol = USERS.find(u => u.id === t.criadoPor);
  document.getElementById('d-solicitante').textContent = sol ? sol.nome : '‚Äì';

  renderTicketChat(t);
  renderTicketHistory(t);
  renderDetailActions(t);

  const overlay = document.getElementById('ticket-detail-overlay');
  overlay.style.display = 'flex';
  overlay.scrollTop = 0;
}

function closeDetail() {
  document.getElementById('ticket-detail-overlay').style.display = 'none';
  currentTicketId = null;
}

function renderTicketChat(t) {
  const msgs = document.getElementById('ticket-chat-msgs');
  msgs.innerHTML = t.chat.length ? t.chat.map(m => {
    const isMine = m.userId === currentUser.id;
    return `<div class="chat-msg ${isMine?'mine':'other'}">
      <div class="chat-bubble">${m.msg}</div>
      <div class="chat-meta">${m.userName} ¬∑ ${formatTime(m.ts)}</div>
    </div>`;
  }).join('') : '<p style="color:var(--text-muted); font-size:13px; text-align:center; padding:16px;">Nenhuma mensagem ainda.</p>';
  msgs.scrollTop = msgs.scrollHeight;
}

function sendTicketMsg() {
  const inp = document.getElementById('ticket-chat-input');
  const msg = inp.value.trim();
  if (!msg || !currentTicketId) return;
  const t = tickets.find(x => x.id === currentTicketId);
  t.chat.push({ userId: currentUser.id, userName: currentUser.nome, msg, ts: Date.now() });
  inp.value = '';
  renderTicketChat(t);
}

function renderTicketHistory(t) {
  document.getElementById('ticket-history').innerHTML = t.history.slice().reverse().map(h => {
    const u = USERS.find(x => x.id === h.usuario);
    return `<div class="log-item">
      <div class="log-dot"></div>
      <div class="log-content">
        <div class="log-action">${h.acao}</div>
        ${h.de ? `<div class="log-detail">${h.de} ‚Üí ${h.para}</div>` : ''}
        <div class="log-time">${u ? u.nome : '‚Äì'} ¬∑ ${formatDate(h.ts)}</div>
      </div>
    </div>`;
  }).join('');
}

function renderDetailActions(t) {
  const bar = document.getElementById('detail-actions');
  bar.innerHTML = '';
  const p = currentUser.perfil;

  if (t.status === 'DONE' || t.status === 'CANCELED') {
    bar.innerHTML = '<p style="color:var(--text-muted); font-size:13px; text-align:center; width:100%;">Chamado encerrado</p>';
    return;
  }

  if (p === 'Atendente') {
    if (t.status === 'OPEN') {
      bar.innerHTML = `<button class="btn btn-secondary" onclick="changeStatus('IN_PROGRESS')">‚ñ∂ Assumir</button>`;
    }
    if (t.status === 'IN_PROGRESS') {
      bar.innerHTML = `
        <button class="btn btn-secondary" onclick="changeStatus('WAITING')">‚è∏ Aguardar</button>
        <button class="btn btn-primary" onclick="changeStatus('DONE')">‚úÖ Concluir</button>`;
    }
    if (t.status === 'WAITING') {
      bar.innerHTML = `<button class="btn btn-primary" onclick="changeStatus('IN_PROGRESS')">‚ñ∂ Retomar</button>`;
    }
  }
  if (p === 'Gestor') {
    bar.innerHTML = `
      <select id="sel-status" style="padding:10px;border-radius:8px;border:1.5px solid var(--border);font-family:inherit;">
        <option value="OPEN" ${t.status==='OPEN'?'selected':''}>Aberto</option>
        <option value="IN_PROGRESS" ${t.status==='IN_PROGRESS'?'selected':''}>Em Andamento</option>
        <option value="WAITING" ${t.status==='WAITING'?'selected':''}>Aguardando</option>
        <option value="DONE" ${t.status==='DONE'?'selected':''}>Conclu√≠do</option>
        <option value="CANCELED">Cancelar</option>
      </select>
      <button class="btn btn-primary" style="flex:1" onclick="changeStatus(document.getElementById('sel-status').value)">Aplicar</button>`;
  }
}

function changeStatus(newStatus) {
  const t = tickets.find(x => x.id === currentTicketId);
  const old = t.status;
  t.status = newStatus;
  t.history.push({ acao: `Status alterado`, de: statusLabel(old), para: statusLabel(newStatus), usuario: currentUser.id, ts: Date.now() });
  showToast(`Status: ${statusLabel(newStatus)}`);
  openDetail(currentTicketId);
  renderTickets(currentFilter);
  renderDashboard();
  updateBadge();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NEW TICKET
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function openNewTicketModal() {
  document.getElementById('modal-new-ticket').classList.add('active');
}
function closeNewTicketModal() {
  document.getElementById('modal-new-ticket').classList.remove('active');
}
function submitNewTicket() {
  const titulo = document.getElementById('nt-titulo').value.trim();
  if (!titulo) { showToast('Informe o t√≠tulo!'); return; }
  const nt = makeTicket({
    titulo,
    descricao: document.getElementById('nt-descricao').value.trim(),
    categoria: document.getElementById('nt-categoria').value,
    prioridade: document.getElementById('nt-prioridade').value,
    setor: document.getElementById('nt-setor').value,
    local: document.getElementById('nt-local').value,
    equip: document.getElementById('nt-equip').value,
    impacto: document.getElementById('nt-impacto').value,
    parada: parseInt(document.getElementById('nt-parada').value)||0,
    criadoPor: currentUser.id,
    criadoEm: Date.now(),
    status: 'OPEN',
    responsavel: null
  });
  tickets.unshift(nt);
  closeNewTicketModal();
  showToast(`‚úÖ Chamado ${nt.proto} aberto!`);
  renderTickets('todos');
  renderDashboard();
  updateBadge();
  navTo('tickets');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SECTOR CHAT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initChat() {
  const tabs = document.getElementById('sector-tabs');
  let setores = ['Produ√ß√£o','Mec√¢nica','Irriga√ß√£o','Packing House','Gest√£o'];
  if (currentUser.perfil !== 'Gestor') {
    setores = setores.filter(s => s === currentUser.setor || (currentUser.setor === 'Packing House' && s === 'Packing House'));
    if (!setores.length) setores = [currentUser.setor];
  }
  tabs.innerHTML = setores.map((s,i) =>
    `<div class="sector-tab ${i===0?'active':''}" onclick="switchSector('${s}',this)">${s}</div>`
  ).join('');
  currentSector = setores[0];
  renderSectorChat();
}

function switchSector(s, el) {
  currentSector = s;
  document.querySelectorAll('.sector-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  renderSectorChat();
}

function renderSectorChat() {
  if (!sectorChats[currentSector]) sectorChats[currentSector] = [];
  const msgs = sectorChats[currentSector];
  const el = document.getElementById('sector-chat-msgs');
  el.innerHTML = msgs.length ? msgs.map(m => {
    const isMine = m.user.id === currentUser.id;
    return `<div class="chat-msg ${isMine?'mine':'other'}">
      <div class="chat-bubble">${m.msg}</div>
      <div class="chat-meta">${m.user.nome} ¬∑ ${formatTime(m.ts)}</div>
    </div>`;
  }).join('') : '<p style="color:var(--text-muted); font-size:13px; text-align:center; padding:20px;">Seja o primeiro a enviar uma mensagem!</p>';
  el.scrollTop = el.scrollHeight;
}

function sendSectorMsg() {
  const inp = document.getElementById('sector-chat-input');
  const msg = inp.value.trim();
  if (!msg) return;
  if (!sectorChats[currentSector]) sectorChats[currentSector] = [];
  sectorChats[currentSector].push({ user: currentUser, msg, ts: Date.now() });
  inp.value = '';
  renderSectorChat();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// EQUIPAMENTOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const equipIcons = { Trator:'üöú', Pulverizador:'üåø', Bomba:'üíß', Esteira:'‚öôÔ∏è', 'C√¢mara Fria':'üßä' };
function renderEquip() {
  const list = currentUser.perfil === 'Gestor' ? equipamentos :
    equipamentos.filter(e => e.setor === currentUser.setor);
  document.getElementById('equip-list').innerHTML = list.map(e => {
    const icon = equipIcons[e.tipo] || 'üîß';
    return `<div class="equip-card" onclick="showEquipDetail(${e.id})">
      <div class="equip-icon">${icon}</div>
      <div class="equip-info">
        <div class="equip-name">${e.nome}</div>
        <div class="equip-code">${e.codigo} ¬∑ ${e.tipo} ¬∑ ${e.setor}</div>
        ${e.horimetro != null ? `<div class="equip-code">‚è± ${e.horimetro}h</div>` : ''}
      </div>
      <div class="equip-status ${e.status}">${e.status === 'manutencao' ? 'Manuten√ß√£o' : e.status.charAt(0).toUpperCase()+e.status.slice(1)}</div>
    </div>`;
  }).join('');
}

function showEquipDetail(id) {
  const e = equipamentos.find(x => x.id === id);
  const relTickets = tickets.filter(t => t.equip.includes(e.codigo));
  showToast(`${e.nome} ¬∑ ${relTickets.length} chamado(s) relacionado(s)`);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ADMIN PANEL (Gestor only)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showAdminPanel() {
  if (currentUser.perfil !== 'Gestor') { showToast('Acesso restrito ao Gestor.'); return; }
  showToast('Painel Admin: dispon√≠vel na vers√£o completa com backend.');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function formatDate(ts) {
  const d = new Date(ts);
  return d.toLocaleDateString('pt-BR', { day:'2-digit', month:'2-digit', year:'numeric', hour:'2-digit', minute:'2-digit' });
}
function formatTime(ts) {
  const d = new Date(ts);
  return d.toLocaleTimeString('pt-BR', { hour:'2-digit', minute:'2-digit' });
}

let toastTimer;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), 2800);
}

// Close modal on backdrop click
document.getElementById('modal-new-ticket').addEventListener('click', function(e) {
  if (e.target === this) closeNewTicketModal();
});

// Enter to send in chats
document.getElementById('sector-chat-input').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendSectorMsg(); }
});
document.getElementById('ticket-chat-input').addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendTicketMsg(); }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
seedData();
</script>
</body>
</html>
